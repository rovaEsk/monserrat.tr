$(function () {    var couleurVar = '#000000',        textColor = '#000000',        plaqueColor = 'transparent',        setCfg = false,        zIndex = 2,        fixation = null,        selected = null,        dwnloading = false,        setcolorHeight = 0,        fontName = $('#police').find(':selected').val(),        theme = 'divers',        dimensionsp,        showDim = true,        nbrElements = 0;    $.data(document.body, 'resizable', false);    $.data(document.body, 'ratioCfg', 0);    $.data(document.body, 'draggable', false);    $.data(document.body, 'rotatable', false);    $.data(document.body, 'currentID', false);    $.data(document.body, 'startCfg', false);    $.data(document.body, 'vWidth', 0);    $.data(document.body, 'vHeight', 0);    $.data(document.body, 'currentImage', false);    $.data(document.body, 'typeplaque', false);    $.data(document.body, 'showColors', false);    $.data(document.body, 'colorSetting', false);    $.data(document.body, 'imgDl', false);    $.data(document.body, 'selfHeight', false);    $.data(document.body, 'textEdit', false);    $.data(document.body, 'typeplaqueVitro', false);    $.data(document.body, 'matierePlaque', false);    $.data(document.body, 'matiereVal', false);    $.data(document.body, 'taillePlaque', 1);    $.data(document.body, 'firstElem', false);    $.data(document.body, 'epaisseur', 3);    $("input[type='text']").click(function () {        $(this).select();    });    function doDraggable() {        $(".draggable").draggable({            containment: "parent",            start: function() {                $(".reset_rotate").fadeOut(), $.data(document.body, "draggable", !0)            },            stop: function() {                setTimeout(function() {                    $.data(document.body, "draggable", !1)                }, 100)            }        })    }    function sleep(miliseconds) {        var currentTime = new Date().getTime();        while (currentTime + miliseconds >= new Date().getTime()) {}    }    function doResizable() {        if ($(".selectedElement").hasClass("typeFond") || $(".selectedElement").hasClass("typeForme")) var e = !1;        else var e = !0;        $(".resizable").each(function() {            $(this).resizable({                containment: "parent",                alsoResize: $(this).find(".elemContent"),                aspectRatio: false,                minHeight: 2,                minWidth: 2,                handles: "se",                start: function() {                    $(".reset_rotate").fadeOut(), $.data(document.body, "resizable", !0);                },                stop: function() {                    $("#longueur").val(), $("#hauteur").val();                    if ($(".selectedElement").hasClass("typeText")) var e = "text";                    else if ($(".selectedElement").hasClass("typeMotif")) var e = "motif";                    else if ($(".selectedElement").hasClass("typeImage")) var e = "image";                    else if ($(".selectedElement").hasClass("typeFond")) var e = "fond";                    else if ($(".selectedElement").hasClass("typeForme")) var e = "forme";                    setTimeout(function() {                        $.data(document.body, "resizable", !1), $.ajax({                            type: "POST",                            url: strUrlModuleHTML5 + "ajax/plaquespro_size.php",                            dataType: "json",                            data: {                                action: "getsize",                                prodID: productID,                                id: $.data(document.body, "currentID"),                                elemWidth: $(".selectedElement").width() + 2,                                elemHeight: $(".selectedElement").height() + 2,                                ratio: $.data(document.body, "ratioCfg"),                                vitWidthpx: $("#plaque_content").width(),                                vitHeightpx: $("#plaque_content").height(),                                vitWidthcm: $("#longueur").val(),                                vitHeightcm: $("#hauteur").val(),                                vitType: $.data(document.body, "typeplaque"),                                vitroType: $.data(document.body, "typeplaqueVitro"),                                size: $.data(document.body, 'taillePlaque'),                                type: e                            },                            success: function(e) {                                $(".selectedElement > .imgH, .selectedElement > .imgL").remove(), $(".selectedElement").append('<img class="imgL" data-elemSize="' + e.longueur + '" style="position: absolute;bottom: -20px;left: 0;" src="data:image/png;base64,' + e.imgL + '" style="" /><img class="imgH" data-elemSize="' + e.hauteur + '" style="position: absolute;bottom: 0;left: -25px;" src="data:image/png;base64,' + e.imgH + '" style="" />');                                var t = $(".selectedElement").find("img.imgH").attr("data-elemsize"),                                    n = $(".selectedElement").find("img.imgL").attr("data-elemsize");                            }                        })                    }, 100);                }            })        })    }    function doRotatable() {        $(".rotatable").each(function() {            $(this).rotatable({                start: function() {                    $.data(document.body, "rotatable", !0), $(".reset_rotate").fadeOut()                },                stop: function() {                    setTimeout(function() {                        $.data(document.body, "rotatable", !1), $(".reset_rotate").fadeOut()                    }, 100)                }            })        })    }    function isNumber(e) {        return !isNaN(parseFloat(e)) && isFinite(e)    }    function getRandomColor() {        for (var e = "0123456789ABCDEF".split(""), t = "#", n = 0; 6 > n; n++) t += e[Math.floor(16 * Math.random())];        return t    }    $.fn.verticalAlign = function() {        return this.css("margin-top", ($(this).parent().height() - $(this).height()) / 2 + "px")    }, $.fn.center = function(e) {        return e = e ? this.parent() : window, this.css({            position: "absolute",            top: ($(e).height() - this.outerHeight()) / 2 + $(e).scrollTop() + "px",            left: ($(e).width() - this.outerWidth()) / 2 + $(e).scrollLeft() + "px"        }), this    }, $.fn.centerV = function(e) {        return e = e ? this.parent() : window, this.css({            position: "absolute",            top: ($(e).height() - this.outerHeight()) / 2 + $(e).scrollTop() + "px"        }), this    }, $.fn.centerH = function(e) {        return e = e ? this.parent() : window, this.css({            position: "absolute",            left: ($(e).width() - this.outerWidth()) / 2 + $(e).scrollLeft() + "px"        }), this    }, $.fn.pressEnter = function(e) {        return this.each(function() {            $(this).bind("enterPress", e), $(this).keyup(function(e) {                13 == e.keyCode && $(this).trigger("enterPress")            })        })    }, ! function(e) {        e.fn.numeric = function(t, n) {            "boolean" == typeof t && (t = {                decimal: t,                negative: !0,                decimalPlaces: -1            }), t = t || {}, "undefined" == typeof t.negative && (t.negative = !0);            var i = t.decimal === !1 ? "" : t.decimal || ".",                a = t.negative === !0 ? !0 : !1,                r = "undefined" == typeof t.decimalPlaces ? -1 : t.decimalPlaces;            return n = "function" == typeof n ? n : function() {}, this.data("numeric.decimal", i).data("numeric.negative", a).data("numeric.callback", n).data("numeric.decimalPlaces", r).keypress(e.fn.numeric.keypress).keyup(e.fn.numeric.keyup).blur(e.fn.numeric.blur)        }, e.fn.numeric.keypress = function(t) {            var n = e.data(this, "numeric.decimal"),                i = e.data(this, "numeric.negative"),                a = e.data(this, "numeric.decimalPlaces"),                r = t.charCode ? t.charCode : t.keyCode ? t.keyCode : 0;            if (13 == r && "input" == this.nodeName.toLowerCase()) return !0;            if (13 == r) return !1;            var s = !1;            if (t.ctrlKey && 97 == r || t.ctrlKey && 65 == r) return !0;            if (t.ctrlKey && 120 == r || t.ctrlKey && 88 == r) return !0;            if (t.ctrlKey && 99 == r || t.ctrlKey && 67 == r) return !0;            if (t.ctrlKey && 122 == r || t.ctrlKey && 90 == r) return !0;            if (t.ctrlKey && 118 == r || t.ctrlKey && 86 == r || t.shiftKey && 45 == r) return !0;            if (48 > r || r > 57) {                var l = e(this).val();                if (0 !== e.inArray("-", l.split("")) && i && 45 == r && (0 === l.length || 0 === parseInt(e.fn.getSelectionStart(this), 10))) return !0;                n && r == n.charCodeAt(0) && -1 != e.inArray(n, l.split("")) && (s = !1), 8 != r && 9 != r && 13 != r && 35 != r && 36 != r && 37 != r && 39 != r && 46 != r ? s = !1 : "undefined" != typeof t.charCode && (t.keyCode == t.which && 0 !== t.which ? (s = !0, 46 == t.which && (s = !1)) : 0 !== t.keyCode && 0 === t.charCode && 0 === t.which && (s = !0)), n && r == n.charCodeAt(0) && (s = -1 == e.inArray(n, l.split("")) ? !0 : !1)            } else if (s = !0, n && a > 0) {                var c = e.inArray(n, e(this).val().split(""));                c >= 0 && e(this).val().length > c + a && (s = !1)            }            return s        }, e.fn.numeric.keyup = function() {            var t = e(this).val();            if (t && t.length > 0) {                var n = e.fn.getSelectionStart(this),                    i = e.fn.getSelectionEnd(this),                    a = e.data(this, "numeric.decimal"),                    r = e.data(this, "numeric.negative"),                    s = e.data(this, "numeric.decimalPlaces");                if ("" !== a && null !== a) {                    var l = e.inArray(a, t.split(""));                    0 === l && (this.value = "0" + t, n++, i++), 1 == l && "-" == t.charAt(0) && (this.value = "-0" + t.substring(1), n++, i++), t = this.value                }                for (var c = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, "-", a], o = t.length, u = o - 1; u >= 0; u--) {                    var d = t.charAt(u);                    0 !== u && "-" == d ? t = t.substring(0, u) + t.substring(u + 1) : 0 !== u || r || "-" != d || (t = t.substring(1));                    for (var h = !1, m = 0; m < c.length; m++)                        if (d == c[m]) {                            h = !0;                            break                        }                    h && " " != d || (t = t.substring(0, u) + t.substring(u + 1))                }                var f = e.inArray(a, t.split(""));                if (f > 0)                    for (var p = o - 1; p > f; p--) {                        var g = t.charAt(p);                        g == a && (t = t.substring(0, p) + t.substring(p + 1))                    }                if (a && s > 0) {                    var l = e.inArray(a, t.split(""));                    l >= 0 && (t = t.substring(0, l + s + 1), i = Math.min(t.length, i))                }                this.value = t, e.fn.setSelection(this, [n, i])            }        }, e.fn.numeric.blur = function() {            var t = e.data(this, "numeric.decimal"),                n = e.data(this, "numeric.callback"),                i = e.data(this, "numeric.negative"),                a = this.value;            if ("" !== a) {                var r = new RegExp(i ? "-?" : "^\\d+$|^\\d*" + t + "\\d+$");                r.exec(a) || n.apply(this)            }        }, e.fn.removeNumeric = function() {            return this.data("numeric.decimal", null).data("numeric.negative", null).data("numeric.callback", null).data("numeric.decimalPlaces", null).unbind("keypress", e.fn.numeric.keypress).unbind("keyup", e.fn.numeric.keyup).unbind("blur", e.fn.numeric.blur)        }, e.fn.getSelectionStart = function(e) {            if ("number" === e.type) return void 0;            if (e.createTextRange && document.selection) {                var t = document.selection.createRange().duplicate();                return t.moveEnd("character", e.value.length), "" == t.text ? e.value.length : Math.max(0, e.value.lastIndexOf(t.text))            }            try {                return e.selectionStart            } catch (n) {                return 0            }        }, e.fn.getSelectionEnd = function(e) {            if ("number" === e.type) return void 0;            if (e.createTextRange && document.selection) {                var t = document.selection.createRange().duplicate();                return t.moveStart("character", -e.value.length), t.text.length            }            return e.selectionEnd        }, e.fn.setSelection = function(e, t) {            if ("number" == typeof t && (t = [t, t]), t && t.constructor == Array && 2 == t.length)                if ("number" === e.type) e.focus();                else if (e.createTextRange) {                    var n = e.createTextRange();                    n.collapse(!0), n.moveStart("character", t[0]), n.moveEnd("character", t[1] - t[0]), n.select()                } else {                    e.focus();                    try {                        e.setSelectionRange && e.setSelectionRange(t[0], t[1])                    } catch (i) {}                }        }    }(jQuery), jQuery.fn.repeatedclick = function(e, t) {        var n = {                duration: 350,                speed: .85,                min: 50            },            i = jQuery.extend(n, t);        "undefined" == typeof jQuery.repeatedEvents && (jQuery.repeatedEvents = []), jQuery.repeatedEvents.push(e);        var a, r, s = jQuery.repeatedEvents.length - 1;        return this.each(function() {            a = function(e, t, n) {                var s = this;                jQuery.repeatedEvents[e].call(s, n), r = setTimeout(function() {                    a.call(s, e, t > i.min ? t * i.speed : t, n)                }, t)            }, jQuery(this).mousedown(function(e) {                a.call(this, s, i.duration, e)            });            var e = function() {                "undefined" != typeof r && clearInterval(r)            };            jQuery(this).mouseout(e), jQuery(this).mouseup(e)        })    };var mouseDrag = $.ui.resizable.prototype._mouseDrag;    $.ui.resizable.prototype._mouseDrag = function (event) {        event.shiftKey = !event.shiftKey;        var aspectRatio = this._aspectRatio;        this._aspectRatio = aspectRatio && event.shiftKey;        mouseDrag.apply(this, arguments);        this._aspectRatio = aspectRatio;    };    /** END - resize upload data**/    /** calcul prix **/    function calculPrixTotal() {        var categorieDimensionId = parseInt($('#dimensionssel').val()),            matiereId = parseInt($('#matiere').val());        var fixation = $('.selectfixation.selected').attr('id');        //console.log(fixation);        $.ajax({            type: "POST",            dataType: "json",            url: strUrlModuleHTML5 + "ajax/plaquesproPrix.php",            data: {                categorieDimensionId: categorieDimensionId,                matiereId: matiereId,                fixation: fixation,            },            success: function(result) {                //console.log(result.prixHT)                var prixHT = parseFloat(result.prixHT).toFixed(2);                var tva = (Math.round(parseFloat(result.prixHT)) / 100) * tvaNormal;                var prixTTC = parseFloat(prixHT) + parseFloat(tva);                $('#prix_ht span').html(Number(prixHT).toFixed(2));                $('#prix_ttc span').html(Number(prixTTC).toFixed(2));                //console.log('fin');            }        });    }    /** end calcul prix **/    function showfirstElem() {        if (!$.data(document.body, 'firstElem')) {            Lobibox.notify('info', {                msg: 'Utilisez les flèches de votre clavier pour déplacer l\'élément séléctionné et la touche Suppr. pour le supprimer.',                img: 'html5/img/keyboard.png',                title: 'Raccourcis clavier',                showClass: 'fadeInDown',                hideClass: 'fadeUpDown',                delay: 10000,                sound: false            });            $.data(document.body, 'firstElem', true);        }    }    $('.epaisseur').iCheck({        checkboxClass: 'icheckbox_flat',        radioClass: 'iradio_flat-red'    });    $('input').on('ifChecked', function (event) {        var epaisseur = $(this).attr('data-epaisseur');        $.data(document.body, 'epaisseur', epaisseur);        $.post(strUrlModuleHTML5 + "ajax/updateThickness.php", {thickness: epaisseur});    });    $('#epaisseur').change(function () {        var epaisseur = $(this).val();        var parentWidth = $('#plaque_content').width();        if ($('#plaque_content #bordure').length == 0) {            $('#plaque_content').append('<div id="bordure" style="width:100%;height:100%;"><div style="width:100%;height:100%;" id="bordure_interne" style="box-shadow: inset 0 0 0 ' + epaisseur + 'px #000000;"></div></div>');        } else {            $('#bordure_interne').css('box-shadow', 'inset 0 0 0 ' + epaisseur + 'px #000000');        }    });    $('#distance').change(function () {        var distance = $(this).val();        if ($('#plaque_content #bordure').length != 0 && isNumber(distance) && distance >= 0) {        }    });    $('#matiere').ddlist({        width: 200,        onSelected: function (index, value, text) {            var thisVal = value;            //---------------------- INIT PRIX MATIERE ------------------            var dimension = $.data(document.body, 'taillePlaque');            /** show POPUP **/            var elemCount = $('#plaque_content .elementContainer').length;            if (elemCount >= 1) {                swal({                    title: "Attention",                    text: "Vous perdrez votre travail si vous changez la matière de votre plaque et vous devrez recommencer votre création",                    type: "warning",                    showCancelButton: true,                    confirmButtonColor: "#DD6B55",                    confirmButtonText: "Recommencer",                    cancelButtonText: "Annuler",                    closeOnConfirm: true,                    closeOnCancel: true                }, function(isConfirm) {                    if (isConfirm) {                        $('#calques > li').remove();                        $('#plaque_content .elementContainer').remove();                        $.post('../rapidpubapp/ajax/reset.php', function(data) {                            $('#prix_ht span').html('0.00');                            $('#prix_ttc span').html('0.00');                        });                        nbrElements = 0;                        $('#matiere').ddlist('select', { value: $.data(document.body, 'matiereVal') });                        $('#matiere').ddlist('select', { value: thisVal });                        return false;                    } else {                        $('#matiere').ddlist('select', { value: $.data(document.body, 'matiereVal') });                        return false;                    }                });                return false;            }            console.log("CHANGE MATIERE");            /** show POPUP **/            var ed = document.getElementById("dimensionssel");            var edVal = $('#dimensionssel').val();            //if (ed.options[ed.selectedIndex].text == "Dimensions"){            console.log("dim value : " + dimension);            if(dimension == "0"){                swal({                    title: "Attention",                    text: "Vous devez saisir au moins choisir une dimension avant de pouvoir continuer!",                    type: "warning",                    closeOnConfirm: true                });                return false;            }            var dimensiontext = ed.options[ed.selectedIndex].text;            /** ---- setPrix ---- **/            setPrixDimensionMatiere( dimension, thisVal);            /** ---  setPrix ---- **/                //------------------------ INIT PRIX MATIERE ------------------            $.data(document.body, 'matiereVal', thisVal);            //console.log(">> id matiere :" + value + "path img " + strUrlModuleHTML5);             console.log("id plaque : "+value);            switch (value) {                case '3':                    $('#plaque_content').css({'backgroundColor': 'transparent', 'backgroundImage': 'url('+strUrlModuleHTML5 + '/img/alu-brosse.jpg)'});                    $('#showcolorpicker2, #hidecolorpicker1').hide();                    $('#hidecolorpicker2, #showcolorpicker1').show();                    $('#apercu_content').css('background-color', '#fff');                    $.data(document.body, 'matierePlaque', false);                    $.data(document.body, 'imgDl', false);                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'none', 'padding': 0});                    $('.epaisseur').slideUp();                    $('#2').parent().addClass('checked');                    $('#2').parent().siblings().removeClass('checked');                    $('#fix1,#adhesifs').show();                    $('#fix2').hide();                    $('#fix1').click();                    $('#color40').hide(100, function () {                        setcolorHeight = 130;                        $('#elemColor').hide();                        $('#color60').show();                    });                    couleurVar = '#000';                    textColor = '#000';                    break;                case '9':                    //--------------------------------------------------                    //# 5Pas de possibilité de modifier la couleur de fond ( la couleur de fond doit etre la texture laiton )                    //pas de possibilité de modifier la couleur du texte et élémént ( couleur du texte uniquement noir)                    //------------------------------------------------------                    $('#plaque_content').css({'backgroundColor': 'transparent', 'backgroundImage': 'url('+strUrlModuleHTML5 + '/img/laiton-brosse.png)'});                    $('#showcolorpicker2, #showcolorpicker1').hide();                    $('#hidecolorpicker2, #hidecolorpicker1').show();                    $('#apercu_content').css('background-color', '#fff');                    $.data(document.body, 'matierePlaque', false);                    $.data(document.body, 'imgDl', false);                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'none', 'padding': 0});                    $('.epaisseur').slideUp();                    $('#2').parent().addClass('checked');                    $('#2').parent().siblings().removeClass('checked');                    $('#fix1').hide();                    $('#fix2').show();                    $('#fix2').click();                    $('#black-col').show();                    $('#gold-col, #white-col').hide();                    $('#color60').hide(100, function () {                        setcolorHeight = 205;                        $('#elemColor').show();                        $('#color40').show();                    });                    couleurVar = '#000';                    textColor = '#000';                    break;                case '1':                    $.data(document.body, 'matierePlaque', 'plexi');                    var taille = $.data(document.body, 'taillePlaque');                    //$('#showcolorpicker2, #showcolorpicker1').show();                    //$('#hidecolorpicker2, #hidecolorpicker1').hide();                    $('#showcolorpicker2, #hidecolorpicker1').hide();                    $('#hidecolorpicker2, #showcolorpicker1').show();                    $('#plaque_content').css({'backgroundColor': 'transparent', 'backgroundImage': 'url('+strUrlModuleHTML5 + '/img/plexi-' + taille + '.png)'});                    $('#apercu_content').css('background-color', '#fff');                    $.data(document.body, 'imgDl', true);                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'none', 'padding': 0});                    $('.epaisseur').slideDown();                    $('#fix1,#fix2').show();                    $('#adhesifs').hide();                    $('#fix1').click();                    $('#color60').hide(100, function () {                        setcolorHeight = 205;                        $('#elemColor').show();                        $('#color40').show();                    });                    couleurVar = '#000';                    textColor = '#000';                    break;                case '6':                    $('#showcolorpicker2, #showcolorpicker1').show();                    $('#hidecolorpicker2, #hidecolorpicker1').hide();                    $('#plaque_content').css({'backgroundColor': 'transparent', 'backgroundImage': 'url('+strUrlModuleHTML5 + '/img/depoli-argent.jpg)'});                    $('#apercu_content').css('background-color', '#fff');                    $.data(document.body, 'imgDl', false);                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'none', 'padding': 0});                    $('.epaisseur').slideUp();                    $('#2').parent().addClass('checked');                    $('#2').parent().siblings().removeClass('checked');                    $('#fix1,#fix2,#adhesifs').show();                    $('#fix1').click();                    $('#color60').hide(100, function () {                        setcolorHeight = 205;                        $('#elemColor').show();                        $('#color40').show();                    });                    couleurVar = '#000';                    textColor = '#000';                    break;                case '7':                    //--------------------------------------------------------------                    //#6                    // possibilité de modifié couleur de fond avec la large pallette de couleur et petit carré de couleur                    // possibilité de modifier couleur du texte et élément avec la large pallette de couleur et petit carré de couleur                    //--------------------------------------------------------------                    $('#showcolorpicker2, #showcolorpicker1').show();                    $('#hidecolorpicker2, #hidecolorpicker1').hide();                    $('#plaque_content').css({'backgroundColor': '#fff', 'backgroundImage': 'none'});                    $('#apercu_content').css('background-color', '#565656');                    $.data(document.body, 'imgDl', true);                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'none', 'padding': 0});                    $('.epaisseur').slideUp();                    //---------------------------------------------                    $('#1').parent().addClass('checked');                    $('#1').parent().siblings().removeClass('checked');                    //----------------------------------------------                    $('#fix1,#fix2,#adhesifs').hide();                    $('#aucune').click();                    $('#color60').hide(100, function () {                        setcolorHeight = 205;                        $('#elemColor').show();                        $('#color40').show();                    });                    couleurVar = '#000';                    textColor = '#000';                    break;                case '8':                    $('#showcolorpicker2, #hidecolorpicker1').hide();                    $('#hidecolorpicker2, #showcolorpicker1').show();                    $('#plaque_content').css({'backgroundColor': 'transparent', 'backgroundImage': 'url('+strUrlModuleHTML5 + '/img/plaque-inox.jpg)'});                    $('#apercu_content').css('background-color', '#fff');                    $.data(document.body, 'matierePlaque', false);                    $.data(document.body, 'imgDl', false);                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'none', 'padding': 0});                    $('.epaisseur').slideUp();                    $('#fix1,#aucune,#adhesifs').show();                    $('#fix2').hide();                    $('#fix1').click();                    $('#color60').hide(100, function () {                        setcolorHeight = 205;                        $('#elemColor').show();                        $('#color40').show();                    });                    couleurVar = '#000';                    textColor = '#000';                    break;                case '14':                    $('#showcolorpicker2, #hidecolorpicker1').hide();                    $('#hidecolorpicker2, #showcolorpicker1').show();                    $('#plaque_content').css({'backgroundColor': 'transparent', 'backgroundImage': 'url('+strUrlModuleHTML5 + '/img/plaque-inox-brosse.jpg)'});                    $('#apercu_content').css('background-color', '#fff');                    $.data(document.body, 'matierePlaque', false);                    $.data(document.body, 'imgDl', false);                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'none', 'padding': 0});                    $('.epaisseur').slideUp();                    $('#fix1,#aucune,#adhesifs').show();                    $('#fix2').hide();                    $('#fix1').click();                    $('#color60').hide(100, function () {                        setcolorHeight = 205;                        $('#elemColor').show();                        $('#color40').show();                    });                    couleurVar = '#000';                    textColor = '#000';                    break;                case '12':                    $('#showcolorpicker2, #showcolorpicker1').hide();                    $('#hidecolorpicker2, #hidecolorpicker1').show();                    $('#plaque_content').css({'backgroundColor': '#d5b36a', 'backgroundImage': 'none'});                    $('#apercu_content').css('background-color', '#fff');                    $.data(document.body, 'imgDl', false);                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'none', 'padding': 0});                    $('.epaisseur').slideUp();                    $('#fix1,#fix2,#adhesifs').show(); $('#fix2').click();                    $('#black-col').show(); $('#gold-col, #white-col').hide();                    $('#color60').hide(100, function(){                        setcolorHeight = 205;                        $('#elemColor').show();                        $('#color40').show();                    });                    couleurVar = '#000';                    textColor = '#000';                    break;                case '13':                    $('#showcolorpicker2, #showcolorpicker1').hide();                    $('#hidecolorpicker2, #hidecolorpicker1').show();                    $('#plaque_content').css({'backgroundColor': '#000', 'backgroundImage': 'none'});                    $('#apercu_content').css('background-color', '#fff');                    $.data(document.body, 'imgDl', false);                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'none', 'padding': 0});                    $('.epaisseur').slideUp();                    $('#fix1,#fix2,#adhesifs').show();                    $('#fix1').click();                    //$('#gold-col, #white-col').show();                    //$('#black-col').hide();                    $('#white-col').show();                    $('#black-col').hide();                    $('#gold-col').show();                    $('#color60').hide(100, function () {                        setcolorHeight = 205;                        $('#elemColor').show();                        $('#color40').show();                    });                    /*                     couleurVar = '#d5b36a';                     textColor = '#d5b36a';                     */                    couleurVar = '#ffffff';                    textColor = '#ffffff';                    break;                case '2':                    /** behaviour #2 Plaque plexi avec couleur de fond **/                    $('#plaque_content').css({'backgroundColor': '#fff', 'backgroundImage': 'url()', 'background-size': 'cover'});                    $('#showcolorpicker1, #showcolorpicker2').show();                    $('#hidecolorpicker2').hide();                    $('#apercu_content').css('background-color', '#fff');                    $.data(document.body, 'matierePlaque', false);                    $.data(document.body, 'imgDl', false);                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'none', 'padding': 0});                    $('.epaisseur').slideDown();                    $('#2').parent().addClass('checked');                    $('#2').parent().siblings().removeClass('checked');                    $('#fix1,#adhesifs').show();                    $('#fix2').hide();                    $('#fix1').click();                    $('#color40').show(100, function () {                        setcolorHeight = 205;                        $('#elemColor').show();                        $('#color60').show();                    });                    couleurVar = '#000';                    textColor = '#000';                    /** behaviour #2**/                    break;                case '15':                    var taille = $.data(document.body, 'taillePlaque');                    $('#showcolorpicker2, #hidecolorpicker1').hide();                    $('#hidecolorpicker2, #showcolorpicker1').show();                    $('#plaque_content').css({'backgroundColor': 'transparent', 'backgroundImage': 'url('+strUrlModuleHTML5 + '/img/plexi-' + taille + '.png)'});                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'url('+strUrlModuleHTML5 + '/img/double-plaques-or-brosse.jpg)', 'padding': '3px'});                    $('#apercu_content').css('background-color', '#fff');                    $.data(document.body, 'imgDl', false);                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('.epaisseur').slideUp();                    $('#fix1,#fix2,#adhesifs').show();                    $('#fix2').click();                    $('#color60').hide(100, function () {                        setcolorHeight = 205;                        $('#elemColor').show();                        $('#color40').show();                    });                    couleurVar = '#000';                    textColor = '#000';                    break;                case '16':                    var taille = $.data(document.body, 'taillePlaque');                    $('#showcolorpicker2, #hidecolorpicker1').hide();                    $('#hidecolorpicker2, #showcolorpicker1').show();                    $('#plaque_content').css({'backgroundColor': 'transparent', 'backgroundImage': 'url('+strUrlModuleHTML5 + '/img/plexi-' + taille + '.png)'});                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'url('+strUrlModuleHTML5 + '/img/double-plaques-alu-brosse.jpg)', 'padding': '3px'});                    $('#apercu_content').css('background-color', '#fff');                    $.data(document.body, 'imgDl', false);                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('.epaisseur').slideUp();                    $('#fix1,#fix2,#adhesifs').show();                    $('#fix1').click();                    $('#color60').hide(100, function () {                        setcolorHeight = 205;                        $('#elemColor').show();                        $('#color40').show();                    });                    couleurVar = '#000';                    textColor = '#000';                    break;                case '19':                    $('#plaque_content').css({'backgroundColor': 'transparent', 'backgroundImage': 'url(' + strUrlModuleHTML5 + '/img/alu-brosse.jpg)'});                    $('#showcolorpicker2, #hidecolorpicker1').hide();                    $('#hidecolorpicker2, #showcolorpicker1').show();                    $('#apercu_content').css('background-color', '#fff');                    $.data(document.body, 'matierePlaque', false);                    $.data(document.body, 'imgDl', false);                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'none', 'padding': 0});                    $('.epaisseur').slideUp();                    $('#fix1,#adhesifs').show(); $('#fix2').hide(); $('#fix1').click();                    $('#color40').hide(100, function(){                        setcolorHeight = 130;                        $('#elemColor').hide();                        $('#color60').show();                    });                    couleurVar = '#000';                    textColor = '#000';                    break;                case '20':                    var taille = $.data(document.body, 'taillePlaque');                    $('#showcolorpicker2, #hidecolorpicker1').hide();                    $('#hidecolorpicker2, #showcolorpicker1').show();                    $('#plaque_content').css({'backgroundColor': 'transparent', 'backgroundImage': 'url(' + strUrlModuleHTML5 + '/img/plexi-' + taille + '.png)'});                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'url(' + strUrlModuleHTML5 + '/img/double-plaques-alu-brosse.jpg)', 'padding': '3px'});                    $('#apercu_content').css('background-color', '#fff');                    $.data(document.body, 'imgDl', false);                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('.epaisseur').slideDown();                    $('#fix1,#fix2,#adhesifs').show(); $('#fix1').click();                    $('#color60').hide(100, function(){                        setcolorHeight = 205;                        $('#elemColor').show();                        $('#color40').show();                    });                    couleurVar = '#000';                    textColor = '#000';                    break;                case '21':                    var taille = $.data(document.body, 'taillePlaque');                    $('#showcolorpicker2, #hidecolorpicker1').hide();                    $('#hidecolorpicker2, #showcolorpicker1').show();                    $('#plaque_content').css({'backgroundColor': 'transparent', 'backgroundImage': 'url(' + strUrlModuleHTML5 + '/img/plexi-' + taille + '.png)'});                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'url(' + strUrlModuleHTML5 + '/img/double-plaques-or-brosse.jpg)', 'padding': '3px'});                    $('#apercu_content').css('background-color', '#fff');                    $.data(document.body, 'imgDl', false);                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('.epaisseur').slideDown();                    $('#fix1,#fix2,#adhesifs').show(); $('#fix2').click();                    $('#color60').hide(100, function(){                        setcolorHeight = 205;                        $('#elemColor').show();                        $('#color40').show();                    });                    couleurVar = '#000';                    textColor = '#000';                    break;                case '22':                    $('#showcolorpicker2, #hidecolorpicker1').hide();                    $('#hidecolorpicker2, #showcolorpicker1').show();                    /** to disable fond couleur **/                    $('#plaque_content').css({'backgroundColor': 'transparent', 'backgroundImage': 'url(' + strUrlModuleHTML5 + '/img/depoli-or.jpg)'});                    $('#apercu_content').css('background-color', '#fff');                    $.data(document.body, 'imgDl', false);                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'none', 'padding': 0});                    $('.epaisseur').slideDown();                    $('#fix1,#fix2,#adhesifs').show(); $('#fix1').click();                    $('#color60').hide(100, function(){                        setcolorHeight = 205;                        $('#elemColor').show();                        $('#color40').show();                    });                    couleurVar = '#000';                    textColor = '#000';                    break;                case '23':                    /** to disable fond couleur **/                    $('#showcolorpicker2, #hidecolorpicker1').hide();                    $('#hidecolorpicker2, #showcolorpicker1').show();                    /** to disable fond couleur **/                    $('#plaque_content').css({'backgroundColor': 'transparent', 'backgroundImage': 'url(' +  strUrlModuleHTML5 + '/img/depoli-argent.jpg)'});                    $('#apercu_content').css('background-color', '#fff');                    $.data(document.body, 'imgDl', false);                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'none', 'padding': 0});                    $('.epaisseur').slideDown();                    $('#fix1,#fix2,#adhesifs').show(); $('#fix1').click();                    $('#color60').hide(100, function(){                        setcolorHeight = 205;                        $('#elemColor').show();                        $('#color40').show();                    });                    couleurVar = '#000';                    textColor = '#000';                    break;                default:                    $('#plaque_content').css("background-image", "transparent");                    $('#colorpicker-element').stop(true).animate({height: 0}, 200);                    $('#plaque_bg').css({'backgroundColor': 'transparent', 'backgroundImage': 'none', 'padding': 0});                    $('#apercu_content').css('background-color', '#fff');                    $('.epaisseur').slideUp();                    $('#fix1,#fix2,#adhesifs').show();                    $('#fix1').click();                    $('#color60').hide(100, function () {                        setcolorHeight = 205;                        $('#elemColor').show();                        $('#color40').show();                    });                    couleurVar = '#000';                    textColor = '#000';            }        }    });    $('#dimensionssel').ddlist({        width: 125,        onSelected: function (index, value, text) {            var thisVal = value;            console.log(thisVal);            //console.log("dimID "+value);            //if (value == '' || value == '0')            //return false;            var elemCount = $('#plaque_content .elementContainer').length;            /** ========= SHOW POPUP ============= **/            if (elemCount >= 1) {                swal({                    title: "Attention",                    text: "Vous perdrez votre travail si vous changez les dimensions de votre plaque et vous devrez recommencer votre création",                    type: "warning",                    showCancelButton: true,                    confirmButtonColor: "#DD6B55",                    confirmButtonText: "Recommencer",                    cancelButtonText: "Annuler",                    closeOnConfirm: true,                    closeOnCancel: true                }, function(isConfirm) {                    if (isConfirm) {                        $('#calques > li').remove();                        $('#plaque_content .elementContainer').remove();                        $.post('../rapidpubapp/ajax/reset.php', function(data) {                            $('#prix_ht span').html('0.00');                            $('#prix_ttc span').html('0.00');                        });                        nbrElements = 0;                        return false;                    } else {                        return false;                    }                });                /** stop ajax **/                return false;            }            console.log("CHANGE DIMENSION");            /** ========= SHOW POPUP ============= **/            $.data(document.body, 'taillePlaque', value);            if ($.data(document.body, 'matierePlaque') == 'plexi') {                $('#plaque_content').css("background-image", strUrlModuleHTML5 + "/img/plexi-" + value + ".png)");            }            //--------------------------------------------------            var matiere = $.data(document.body, 'matiereVal');            //var em = document.getElementById("matiere");            //var matiereText = em.options[em.selectedIndex].text;            var matiereVal = $('#matiere').val();            console.log("selected matier : " + matiereVal);            //if (matiereText == "Matière"){            if (matiereVal == "0"){                $('#matiere').ddlist('select', {value: 1});            }            //----------------------------------------------------            /** ---- setPrix ---- **/            setPrixDimensionMatiere(thisVal, matiere);            /** ---  setPrix ---- **/            if (value != '') {                setCfg = true;                $('.fixation, .fixation2').show();            } else {                setCfg = false;                $('.fixation, .fixation2').hide();            }        }    });    $('.selectfixation').click(function (e) {        e.preventDefault();        $('div#fixations .selected').removeClass('selected');        $(this).addClass('selected');        var fixID = $(this).attr('id');        switch (fixID) {            case 'fix1':                //$('.fixation, .fixation2').css('background-image', strUrlModuleHTML5 + '/img/fix1.png)');                $('.fixation, .fixation2').css('background', 'url('+strUrlModuleHTML5 + '/img/fix1.png)');                $('.fixation, .fixation2').css('background-size', '100% 100%');                break;            case 'fix2':                //$('.fixation, .fixation2').css('background-image', strUrlModuleHTML5 + '/img/fix2.png)');                $('.fixation, .fixation2').css('background', 'url('+strUrlModuleHTML5 + '/img/fix2.png)');                $('.fixation, .fixation2').css('background-size', '100% 100%');                break;            case 'aucune':                $('.fixation, .fixation2').css('background-image', 'none');                //---------- inint prix aucune fixation ------------------                //calculPrix('no_fixing');                //---------- inint prix aucune fixation ------------------                break;            case 'adhesifs':                $('.fixation, .fixation2').css('background-image', 'none');                //---------- inint prix fixation adhesif ------------------                //calculPrix('adhesif_fixing');                //---------- inint prix fixation adhesif ------------------                break;        }        calculPrixTotal();    });    /*jQuery(window).on('beforeunload', function() {     return 'Vous perdrez votre travail si vous quittez cette page !';     }).unload(function() {     $.ajax({     type: "POST",     async: false,     url: "ajax/saveSession.php"     });     /**html2canvas( $( "#plaque_bg" ), {     onrendered: function( canvas ) {     var imgCanvas = canvas.toDataURL();     $.ajax({     type: "POST",     async: false,     url: "ajax/postScrn.php",     data: {     imageCanvas: imgCanvas     }     });     }     });**/    //});    $('#drawRect').click(function (e) {        e.preventDefault();        if (setCfg == false) {            swal({                title: "Attention",                text: "Vous devez sélectionner les dimensions de votre plaque avant de pouvoir continuer !",                type: "warning",                closeOnConfirm: true            }, function () {                $('#longueur').effect('highlight', {                    color: '#c70077'                }, 1500);                $('input#longueur').focus();            });            return false;        }        $('#textecfg').val('');        document.getElementById("textecfgsize").value = 12;        $.ajax({            type: "POST",            url: strUrlModuleHTML5 + "ajax/plaquespro_forme.php",            dataType: "json",            data: {                action: 'update',                couleur: textColor,                ratio: $.data(document.body, 'ratioCfg'),                size: $.data(document.body, 'taillePlaque'),                type: 'fond'            },            success: function (result) {                $('.selectedElement').removeClass('selectedElement');                $('#plaque_content').append('<div class="elementContainer typeForme resizable draggable rotatable" id="' + result['id'] + '" style="max-height:100%;position:absolute"><div class="reset_rotate ctrlElem" title="Réinitialiser la position de l\'élement"></div><div class="ctrlElem seresizer ui-resizable-handle ui-resizable-se"></div><div class="ctrlElem delete-element" title="Supprimer l\'élément"></div></div>');                $('#' + result['id']).addClass('selectedElement');                showfirstElem();                $('input.elemSize').prop('disabled', false);                $('.ctrlElem, .imgL, .imgH').hide();                $('.selectedElement').css({                    'width': '50%',                    'height': '5%',                    'position': 'absolute'                });                $('.selectedElement').css('background-color', textColor);                setTimeout(function () {                    var maxWidth = $('#plaque_content').width() - 50;                    var maxHeight = $('#plaque_content').height() - 50;                    var ratio = 0;                    var width = $('#' + result['id']).width();                    var height = $('#' + result['id']).height();                    if (width > maxWidth) {                        ratio = maxWidth / width;                        $('.selectedElement').css("width", maxWidth);                        $('.selectedElement').css("height", height * ratio);                        height = height * ratio;                        width = width * ratio;                    }                    if (height > maxHeight) {                        ratio = maxHeight / height;                        $('.selectedElement').css("height", maxHeight);                        $('.selectedElement').css("width", width * ratio);                        width = width * ratio;                        height = height * ratio;                    }                    $('.selectedElement').center(true);                }, 10);                $('#colorpicker-element').stop(true).animate({                    height: setcolorHeight                }, 200);                $('.selectedElement').attr('data-colorcode', '#000000');                $('#elemColor').colpickSetColor('#000000');                $('.selectedElement div.ctrlElem').show();                $('.selectedElement div.reset_rotate').hide();                var nbrLayers = $('ul#calques li').length;                var newLayer = parseInt(nbrLayers) + 1;                zIndex = zIndex + 1;                $('.selectedElement').css('z-index', zIndex);                $('ul#calques').prepend('<li data-zindex="' + zIndex + '" data-object-id="' + result['id'] + '" class="ui-state-default"><span class="text">Forme</span><span class="layer">calque ' + newLayer + '</span></li>');                $('ul#calques').sortable('refresh');                doDraggable();                doResizable();                doRotatable();                $.data(document.body, 'currentID', result['id']);                setTimeout(function () {                    $.ajax({                        type: "POST",                        url: strUrlModuleHTML5 + "ajax/plaquespro_size.php",                        dataType: "json",                        data: {                            action: 'getsize',                            id: result['id'],                            elemWidth: parseInt($('.selectedElement').css('width'), 10),                            elemHeight: parseInt($('.selectedElement').css('height'), 10),                            ratio: $.data(document.body, 'ratioCfg'),                            vitWidthpx: $('#plaque_content').width(),                            vitHeightpx: $('#plaque_content').height(),                            size: $.data(document.body, 'taillePlaque'),                            type: 'forme'                        },                        success: function (resultx) {                            //$('#' + result['id']).append('<img class="imgL" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: -20px;left: 0;" src="data:image/png;base64,' + resultx['imgL'] + '" style="" /><img class="imgH" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: 0;left: -25px;" src="data:image/png;base64,' + resultx['imgH'] + '" style="" />');                            $('#' + result['id']).append('<img class="imgL" data-elemSize="' + resultx['longueur'] + '" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: -20px;left: 0;" src="data:image/png;base64,' + resultx['imgL'] + '" style="" /><img class="imgH" data-elemSize="' + resultx['hauteur'] + '" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: 0;left: -25px;" src="data:image/png;base64,' + resultx['imgH'] + '" style="" />');                            var thiscmHeight = $('#' + result['id']).find('img.imgH').attr('data-elemsize'),                                thiscmWidth = $('#' + result['id']).find('img.imgL').attr('data-elemsize');                            $('#elem_width').val(thiscmWidth);                            $('#elem_height').val(thiscmHeight);                        }                    });                }, 100);            }        });    });    var tour = {        id: "start-tour",        showPrevButton: true,        scrollTopMargin: 100,        i18n: {            nextBtn: "Suivant",            prevBtn: "Précedent",            doneBtn: "Terminé",            skipBtn: "Passer",            closeTooltip: "Fermer"        },        steps: [{            title: "Dimensions",            content: "Sélectionnez les dimensions (longueur/hauteur) de votre plaque en centimètres. Cette étape est importante car elle nous permet de vous proposer un tarif sur mesure",            target: document.querySelector("#block_right"),            placement: "left"        }, {            title: "Texte et police d'écriture",            content: "Ajoutez des textes sur votre plaque. Cliquez sur Ok ou appuyez sur la touche Entrée de votre clavier pour valider votre saisie.",            target: document.querySelector("#block_right2"),            placement: "left"        }, {            title: "Pictogrammes",            content: "Vous pouvez choisir l'un des pictogrammes que nous vous proposons.",            target: document.querySelector(".motifs_container"),            placement: "left"        }, {            title: "Ajouter votre propre image",            content: "Vous pouvez aussi télécharger et insérer votre propre image (en fonction de la matière sélectionnée).",            target: document.querySelector("#uploadFile"),            placement: "left"        }, {            title: "Dessiner une forme",            content: "Ce bouton sert à dessiner des formes carrés ou rectangulaires sur votre plaque. Vous pouvez utiliser la combinaison 'MAJ + redimensionnement souris' pour conserver les proportions.",            target: document.querySelector("#drawRect"),            placement: "left"        }, {            title: "Couleurs, calques, fonds...",            content: "Cette partie vous permet de modifier la couleur d'un élément sélectionné (entouré en rouge sur l'aperçu), la couleur et les dimensions du fond et aussi de modifier l'ordre de supperposition des calques.",            target: document.querySelector("#block_right4"),            placement: "left"        }, {            title: "Aligner, déplacer, dupliquer, pivoter...",            content: "Ces boutons de contrôles vous permettent d'interagir avec l'élement sélectioné (entouré en rouge sur l'aperçu), vous pouvez le déplacer, le centrer sur votre plaque, le dupliquer ou même le faire pivoter.",            target: document.querySelector("#block_right4_2"),            placement: "left"        }]    };    hopscotch.startTour(tour);    $('#longueur, #hauteur').numeric();    $('#plaque_content, #plaque_bg').click(function (e) {        e.preventDefault();        if ($.data(document.body, 'rotatable') == false && $.data(document.body, 'draggable') == false && $.data(document.body, 'resizable') == false) {            $('.selectedElement div.ctrlElem, .selectedElement .imgL, .selectedElement .imgH').hide();            $('.selectedElement').removeClass('selectedElement');            $('input.elemSize').prop('disabled', true).val('');            $('#colorpicker-element').stop(true).animate({                height: 0            }, 200);            $('#textecfg').val('');            document.getElementById("textecfgsize").value = 12;        }    });    $('#duplicate').click(function (e) {        e.preventDefault();        var thisElem = $('.selectedElement');        if ($('.selectedElement').hasClass('typeFond') || $('.selectedElement').hasClass('typeForme')) {            var thisElemID = thisElem.attr('id');        } else {            var thisElemID = thisElem.find('.elemContent').attr('id');        }        var thisLayer = $('*[data-object-id="' + thisElemID + '"]');        if ($('.selectedElement')[0]) {            var newElem = thisElem.clone();            var typeElem;            $('.ctrlElem, .imgL, .imgH').hide();            $('.selectedElement').removeClass('selectedElement');            $('#plaque_content').append(newElem);            newElem.addClass('selectedElement');            $('input.elemSize').prop('disabled', false);            $('.selectedElement').css({                left: '+=5px',                top: '+=5px'            });            $('.selectedElement').find('.imgL, .imgH').show();            doDraggable();            doResizable();            doRotatable();            if (thisElem.hasClass('typeMotif')) {                typeElem = 'motif';            } else if (thisElem.hasClass('typeText')) {                typeElem = 'text';            } else if (thisElem.hasClass('typeImage')) {                typeElem = 'image';            } else if (thisElem.hasClass('typeFond')) {                typeElem = 'fond';            } else if (thisElem.hasClass('typeForme')) {                typeElem = 'forme';            }            $.ajax({                type: "POST",                url: strUrlModuleHTML5 + "ajax/cloneElem.php",                dataType: "json",                data: {                    action: 'clone',                    prodID: productID,                    id: thisElemID,                    type: typeElem,                },                success: function (resultx) {                    if (resultx) {                        var newid = resultx.id;                        $.data(document.body, 'currentID', newid);                        if (typeElem == 'fond') {                            $('.selectedElement').attr('id', newid);                        } else {                            if (typeElem == 'forme') {                                $('.selectedElement').attr('id', newid);                            } else {                                $('.selectedElement').find('.plaque_element').attr('id', newid);                            }                            zIndex = zIndex + 1;                            $('.selectedElement').css('z-index', zIndex);                            var nbrLayers = $('ul#calques li').length;                            var newLayer = parseInt(nbrLayers) + 1;                            if (thisElem.hasClass('typeMotif')) {                                $('ul#calques').prepend('<li data-zindex="' + zIndex + '" data-object-id="' + newid + '" class="ui-state-default"><img style="width:25px" data-src-code="' + resultx.code + '" src="' + resultx.motif + '" alt="' + resultx.motif + '" /> <span class="layer">calque ' + newLayer + '</span></li>');                            } else if (thisElem.hasClass('typeText')) {                                $('ul#calques').prepend('<li data-zindex="' + zIndex + '" data-object-id="' + newid + '" class="ui-state-default"><span class="text">' + resultx.text + '</span><span class="layer">calque ' + newLayer + '</span></li>');                            } else if (thisElem.hasClass('typeImage')) {                                $('ul#calques').prepend('<li data-zindex="' + zIndex + '" data-object-id="' + newid + '" class="ui-state-default"><img style="width:25px;max-height:100%" src="' + resultx.imgPath + '" alt="' + resultx.imgPath + '" /> <span class="layer">calque ' + newLayer + '</span></li>');                            } else if (thisElem.hasClass('typeForme')) {                                $('ul#calques').prepend('<li data-zindex="' + zIndex + '" data-object-id="' + newid + '" class="ui-state-default"><span class="text">Forme</span><span class="layer">calque ' + newLayer + '</span></li>');                            }                        }                        $('ul#calques').sortable('refresh');                    }                }            });        }    });    $('#uploadFile').click(function (e) {        e.preventDefault();        if (setCfg == false) {            swal({                title: "Attention",                text: "Vous devez sélectionner les dimensions de votre plaque avant de pouvoir continuer !",                type: "warning",                closeOnConfirm: true            }, function () {                $('#longueur').effect('highlight', {                    color: '#c70077'                }, 1500);                $('input#longueur').focus();            });            return false;        } else if (!$.data(document.body, 'imgDl')) {            swal({                title: "Attention",                text: "La matière sélectionnée ne permet pas de télécharger d'image !",                type: "error",                closeOnConfirm: true            });            return false;        } else {            $.fancybox({                href: '#uploadFileContent'            });        }    });    $('.download').click(function (e) {        e.preventDefault();        if (!dwnloading) {            $('#fileinput').val('');            $('#fileinput').trigger('click');        }    });    $("#progressbar").progressbar({        value: 0,        max: 100    });    $('#fileinput').change(function () {        dwnloading = true;        var fileData = $(this).prop('files')[0];        var formData = new FormData();        formData.append('imageupload', fileData);        $('a.download').html('Téléchargement en cours <img src=strUrlModuleHTML5 + "img/ajax-loader.gif" alt="" />');        $("#progressbar").show();        $.ajax({            url: strUrlModuleHTML5 + 'ajax/imageUploadOP.php',            dataType: 'json',            contentType: false,            processData: false,            data: formData,            prodID: productID,            type: 'POST',            xhr: function () {                var xhr = $.ajaxSettings.xhr();                xhr.upload.onprogress = function (evt) {                    var uploadVal = evt.loaded / evt.total * 100;                    $("#progressbar").progressbar("value", uploadVal).children('.ui-progressbar-value').html(uploadVal.toPrecision(3) + '%').css("display", "block");                };                xhr.upload.onload = function () {                    console.log('File downloaded...');                };                return xhr;            },            success: function (result) {                $.data(document.body, 'currentImage', result.id);                console.log($.data(document.body, 'taillePlaque'));                if (result.success == true) {                    var ddListOptionIsSelectedall = $("#dimensionssel option:selected").text();                    ddListOptionIsSelectedall = ddListOptionIsSelectedall.replace("cm", "");                    arraysplit = ddListOptionIsSelectedall.split("x");                    var totalpx = arraysplit[0].trim() * arraysplit[1].trim();                    //console.log(totalpx*7.79527559055);                    var heightpx = $("#plaque_content").css("height");                    var widthpx = $("#plaque_content").css("width");                    var tpx = widthpx.replace("px", "") * heightpx.replace("px", "");                    var limittpx = tpx * 0.25;                    //1 cm = 37.79527559055 pixel                    console.log(limittpx);                    console.log(result.size);                    if (result.size < limittpx) {                        var msgContent = "<img style='max-width:100%;max-height:100px' src='" + result.imgPathOp + "' alt'' /><br><br>La qualité de votre image (<strong>" + result.dpi + " PPP , " + result.size + " Pixel</strong>) est insuffisante, nous recommandons d'utiliser des images avec une qualité de <strong>150 PPP</strong> (points par pouce) minimum pour obtenir un résultat d'impression optimal.";                        var typeContent = "warning";                        var confirmColor = "#DD6B55";                        var confirmText = "Continuer";                        var showCancel = true;                    } else {                        var msgContent = "<img style='max-width:100%;max-height:100px' src='" + result.imgPathOp + "' alt'' /><br><br>La qualité de votre image (<strong>" + result.dpi + " PPP</strong>) est satisfaisante, le rendu d'impression sera optimal.";                        var typeContent = "success";                        var confirmColor = "#A5DC86";                        var confirmText = "Ok";                        var showCancel = false;                    }//                    else {//                        var msgContent = "<img style='max-width:100%;max-height:100px' src='" + result.imgPathOp + "' alt'' /><br><br>Nous n'avons pas pu déterminer la qualité de votre image, nous ne pouvons par conséquent pas garantir le rendu d'impression. Nous vous conseillons vivement de choisir une autre image.";//                        var typeContent = "warning";//                        var confirmColor = "#DD6B55";//                        var confirmText = "Continuer";//                        var showCancel = true;//                    }                    swal({                        title: "Qualité de l'image",                        text: msgContent,                        type: typeContent,                        showCancelButton: showCancel,                        confirmButtonColor: confirmColor,                        confirmButtonText: confirmText,                        cancelButtonText: "Changer d'image",                        closeOnConfirm: true,                        closeOnCancel: true,                        html: true                    }, function (isConfirm) {                        if (isConfirm) {                            $('#plaque_content').append('<div class="elementContainer typeImage resizable draggable rotatable" style="max-height:100%;position:absolute"><div class="reset_rotate ctrlElem" title="Réinitialiser la position de l\'élement"></div><img class="elemContent plaque_element" style="max-height:100%" src="' + result.imgPathOp + '" alt="' + result.imgPathOp + '" id="' + result.id + '" /><div class="ctrlElem seresizer ui-resizable-handle ui-resizable-se"></div><div class="ctrlElem delete-element" title="Supprimer l\'élément"></div></div>');                            setTimeout(function () {                                var maxWidth = $('#plaque_content').width() - 50;                                var maxHeight = $('#plaque_content').height() - 50;                                var ratio = 0;                                var width = $('.selectedElement img.elemContent').width();                                var height = $('.selectedElement img.elemContent').height();                                if (width > maxWidth) {                                    ratio = maxWidth / width;                                    $('.selectedElement, .selectedElement img.elemContent').css("width", maxWidth);                                    $('.selectedElement, .selectedElement img.elemContent').css("height", height * ratio);                                    height = height * ratio;                                    width = width * ratio;                                }                                if (height > maxHeight) {                                    ratio = maxHeight / height;                                    $('.selectedElement, .selectedElement img.elemContent').css("height", maxHeight);                                    $('.selectedElement, .selectedElement img.elemContent').css("width", width * ratio);                                    width = width * ratio;                                    height = height * ratio;                                }                                $('.selectedElement').center(true);                            }, 10);                            $('.selectedElement').removeClass('selectedElement');                            $('#' + result['id']).parent('div').addClass('selectedElement');                            showfirstElem();                            $('input.elemSize').prop('disabled', false);                            $('#colorpicker-element').stop(true).animate({                                height: 0                            }, 200);                            var nbrLayers = $('ul#calques li').length;                            var newLayer = parseInt(nbrLayers) + 1;                            zIndex = zIndex + 1;                            $('.selectedElement').css('z-index', zIndex);                            $('ul#calques').prepend('<li data-zindex="' + zIndex + '" data-object-id="' + result.id + '" class="ui-state-default"><img style="width:25px;max-height: 100%;" src="' + result.imgPath + '" alt="' + result.imgPath + '" /> <span class="layer">calque ' + newLayer + '</span></li>');                            $('ul#calques').sortable('refresh');                            $('.ctrlElem').hide();                            $('.selectedElement div.ctrlElem').show();                            $('.selectedElement div.reset_rotate').hide();                            doDraggable();                            doResizable();                            doRotatable();                            $.data(document.body, 'currentID', result.id);                            setTimeout(function () {                                $.ajax({                                    type: "POST",                                    url: strUrlModuleHTML5 + "ajax/plaquespro_size.php",                                    dataType: "json",                                    data: {                                        action: 'getsize',                                        id: result.id,                                        elemWidth: parseInt($('.selectedElement').css('width'), 10),                                        elemHeight: parseInt($('.selectedElement').css('height'), 10),                                        ratio: $.data(document.body, 'ratioCfg'),                                        vitWidthpx: $('#plaque_content').width(),                                        vitHeightpx: $('#plaque_content').height(),                                        size: $.data(document.body, 'taillePlaque'),                                        type: 'image'                                    },                                    success: function (resultx) {                                        //$('#' + result.id).parent('div.elementContainer').append('<img class="imgL" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: -20px;left: 0;" src="data:image/png;base64,' + resultx['imgL'] + '" style="" /><img class="imgH" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: 0;left: -25px;" src="data:image/png;base64,' + resultx['imgH'] + '" style="" />');                                        $('#' + result['id']).parent('div.elementContainer').append('<img class="imgL" data-elemSize="' + resultx['longueur'] + '" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: -20px;left: 0;" src="data:image/png;base64,' + resultx['imgL'] + '" style="" /><img class="imgH" data-elemSize="' + resultx['hauteur'] + '" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: 0;left: -25px;" src="data:image/png;base64,' + resultx['imgH'] + '" style="" />');                                        var thiscmHeight = $('#' + result['id']).parent('div.elementContainer').find('img.imgH').attr('data-elemsize'),                                            thiscmWidth = $('#' + result['id']).parent('div.elementContainer').find('img.imgL').attr('data-elemsize');                                        $('#elem_width').val(thiscmWidth);                                        $('#elem_height').val(thiscmHeight);                                        //---------- set prix with image --------------                                        //calculPrix('image');                                        calculPrixTotal();                                        //---------- set prix with image --------------                                     },error : function(resultat, statut, erreur){                                        console.log(erreur);                                    }                                });                            }, 100);                            $.fancybox.close();                        } else {                            $.ajax({                                type: "POST",                                url: strUrlModuleHTML5 + "ajax/imageCancel.php",                                dataType: "json",                                data: {                                    action: 'cancel',                                    prodID: productID,                                    id: $.data(document.body, 'currentImage'),                                    type: 'image'                                }                            });                            return false;                        }                    });                    $("#progressbar").hide();                    $("#progressbar").progressbar("value", 0).children('.ui-progressbar-value').html(0 + '%').css("display", "block");                } else {                    swal({                        title: "Attention",                        text: result.msg,                        type: "warning",                        closeOnConfirm: true                    });                }                dwnloading = false;                $('a.download').html('Télécharger');            }        });    });    var typingTimer;    var doneTypingInterval = 2000; //ms    $('.dimensions_plaque').keyup(function () {        clearTimeout(typingTimer);        typingTimer = setTimeout(doneTyping($(this)), doneTypingInterval);    });    $('.dimensions_plaque').keydown(function () {        clearTimeout(typingTimer);    });    function doneTyping(e) {        var typeSel = e.val();        $('.oeilletsAdd').remove();        if (isNumber(typeSel)) {            if ($('#hauteur').val() > 200 && $('#longueur').val() > 200) {                swal({                    title: "Attention",                    html: true,                    text: "<p style='text-align:justify'>Nous ne pouvons imprimer que des plaques rectangulaires où le plus petit côté <strong>ne doit pas excéder 200 cm</strong>.<br>Exemple: 1000 x 200 pour une plaque horizontale ou 200 x 1000 pour une plaque verticale.</p>",                    type: "error",                    closeOnConfirm: true                }, function () {                    $('#longueur').effect('highlight', {                        color: '#c70077'                    }, 1500);                    $('input#longueur').focus();                });                var rectVal = Math.min($('#hauteur').val(), $('#longueur').val());                var rectElem = $('input').filter(function () {                    return this.value == rectVal                });                var rectElemId = rectElem.attr('id');                $('#' + rectElemId).val(200);            }            $.data(document.body, 'vWidth', $('#longueur').val());            $.data(document.body, 'vHeight', $('#hauteur').val());            var longueur = parseInt($('#longueur').val()),                hauteur = parseInt($('#hauteur').val());            if (longueur > hauteur) {                var ratio = hauteur / longueur;                $.data(document.body, 'ratioCfg', ratio);                var newHeight = parseInt(750) * ratio;                if (newHeight <= 500)                    $('#plaque_content').width(750).height(newHeight);                else                    $('#plaque_content').width(500 / ratio).height(500);            } else if (hauteur > longueur) {                var ratio = longueur / hauteur;                $.data(document.body, 'ratioCfg', ratio);                var newWidth = parseInt(500) * ratio;                if (newWidth <= 750)                    $('#plaque_content').height(500).width(500 * ratio);                else                    $('#plaque_content').height(750 / ratio).width(750);            } else if (hauteur == longueur) {                $('#plaque_content').height(500).width(500);            }            $('#plaque_content').center(true);            if (isNumber($('#longueur').val()) && isNumber($('#hauteur').val())) {                setCfg = true;                var left = 50;                var largeVal = Math.max($('#hauteur').val(), $('#longueur').val());                var smallVal = Math.min($('#hauteur').val(), $('#longueur').val());                var largeElem = $('input').filter(function () {                    return this.value == largeVal                });                var largeElemId = largeElem.attr('id');                if (largeVal > 100) {                    var nbrOeillets = parseInt(largeVal / 100);                    if (nbrOeillets == 1)                        var leftD = 50;                    else                        var leftD = 100 / parseInt(nbrOeillets + 1);                    var iterate = leftD;                    for (i = 0; i < nbrOeillets; i++) {                        if (largeElemId == 'longueur')                            $('#oeillets').append('<div class="oeilletsAdd oeilletA oeillet" style="display: block;left:' + leftD + '%"></div><div class="oeilletsAdd oeilletB oeillet" style="display: block;left:' + leftD + '%"></div>');                        else                            $('#oeillets').append('<div class="oeilletsAdd oeilletA oeillet" style="display: block;top:' + leftD + '%"></div><div class="oeilletsAdd oeilletC oeillet" style="display: block;top:' + leftD + '%"></div>');                        leftD += iterate;                    }                }                if (smallVal > 100 && smallVal != 200) {                    if (largeElemId == 'longueur')                        $('#oeillets').append('<div class="oeilletsAdd oeilletA oeillet" style="display: block;top:48%"></div><div class="oeilletsAdd oeilletC oeillet" style="display: block;top:48%"></div>');                    else                        $('#oeillets').append('<div class="oeilletsAdd oeilletA oeillet" style="display: block;left:48%"></div><div class="oeilletsAdd oeilletB oeillet" style="display: block;left:48%"></div>');                } else if (smallVal == 200) {                    var leftX = 33;                    for (i = 0; i < 2; i++) {                        if (largeElemId == 'longueur')                            $('#oeillets').append('<div class="oeilletsAdd oeilletA oeillet" style="display: block;top:' + leftX + '%"></div><div class="oeilletsAdd oeilletC oeillet" style="display: block;top:' + leftX + '%"></div>');                        else                            $('#oeillets').append('<div class="oeilletsAdd oeilletA oeillet" style="display: block;left:' + leftX + '%"></div><div class="oeilletsAdd oeilletB oeillet" style="display: block;left:' + leftX + '%"></div>');                        leftX += leftX;                    }                }                $('.oeillet').show();                var vitWidth = $('#plaque_content').width(),                    vitHeight = $('#plaque_content').height();                $('#plaque_height').html('<span style="color:#ff0000;font-size:10px;">' + hauteur + '</span>').css('height', vitHeight);                $('#plaque_width').html('<span style="color:#ff0000;font-size:10px;">' + longueur + '</span>').css('width', vitWidth);                var plaquexy = $('#plaque_content').offset();                $('#plaque_width').css({                    top: -15,                    left: 0                });                $('#plaque_height').css({                    top: 0,                    left: -20                });            }            $.ajax({                type: "POST",                dataType: "json",                url: strUrlModuleHTML5 + "ajax/plaquePrix.php",                data: {                    bLong: longueur,                    bHaut: hauteur,                },                success: function (result) {                    var prixHT = parseFloat(result.prixHT).toFixed(2);                    var tva = (Math.round(parseFloat(result.prixHT)) / 100) * 20;                    var prixTTC = parseFloat(prixHT) + parseFloat(tva);                    $('#prix_ht span').html(Number(prixHT).toFixed(2));                    $('#prix_ttc span').html(Number(prixTTC).toFixed(2));                }            });        } else {            e.val('');            $('.oeillet').hide();            setCfg = false;            return false;        }    }    $('#textecfg').pressEnter(function () {        $('#add_text').click();    });    $('#conftabs').tabs({        activate: function (event, ui) {            var act = $("#conftabs").tabs("option", "active");            if ( act == 1 ){                $('.selectedElement div.ctrlElem, .selectedElement .imgL, .selectedElement .imgH').hide();                $(".selectedElement").removeClass("selectedElement");                $('#colorpicker-element').stop(true).animate({height: 0}, 200);            }        }    });    $('#themes').ddlist({        width: 150,        onSelected: function (index, value, text) {            $('.motifs_container').hide();            $('#' + value + "_container").show();            theme = value;            var width = 0;            $('#' + value + '_container div.motif').each(function () {                width += $(this).outerWidth(true);            });            $('.motifs_container').css('width', width + 'px');            /*$.ajax({             type: "POST",             dataType: "json",             url: strUrlModuleHTML5 + "ajax/motifs.php",             data: {             motifs: value,             prodID: productID,             ratio: $.data(document.body, 'ratioCfg')             },             success: function(result) {             theme = value;             $('.motifs_container').html('');             $.each(result, function(i, item) {             $('.motifs_container').append('<div title="Ajouter un motif sur votre banderole" class="motif" id="' + item['code'] + '" style="background-size:100%;background-image: url(' + item['path'] + ');"></div>');             });             var width = 0;             $('.motifs_container div.motif').each(function() {             width += $(this).outerWidth(true);             });             $('.motifs_container').css('width', width + 'px');             }             });*/        }    });    var width = 0;    $('.motifs_container').each(function () {        var width = 0;        $(this).find('div.motif').each(function () {            width += $(this).outerWidth(true);        });        $(this).css('width', width + 'px');    });    $('#police').ddlist({        width: 200,        onSelected: function (index, value, text) {            if( $('#police').attr('data-selected') === 'false' ){                return  ;            }            fontName = value;            if ($('.selectedElement').hasClass('typeText')) {                var elementChange = $('.selectedElement').find('.elemContent');                var idCode = elementChange.attr('id');                var altCode = elementChange.attr('alt');                var elemWidth = $('.selectedElement').width();                if ($('.selectedElement').attr("fontsize") != "undefined") {                    textecfgsize = $('.selectedElement').attr("fontsize");                    //document.getElementById("textecfgsize").value = textecfgsize;                } else {                    textecfgsize = $("#textecfgsize").val();                }                //$('.selectedElement').find('img.elemContent').attr('data-ccode', color);                console.log("trigger:police");                $.ajax({                    type: "POST",                    dataType: "json",                    url: strUrlModuleHTML5 + "ajax/plaquespro_text.php",                    data: {                        action: 'update',                        text: encodeURIComponent(altCode),                        couleur: couleurVar,                        font: fontName,                        font7: fontName,                        fontsize: textecfgsize,                        id: idCode,                        ratio: $.data(document.body, 'ratioCfg')                    },                    success: function (result) {                        elementChange.attr('src', 'data:image/png;base64,' + result['image']);                        $('.selectedElement').css({                            'height': 'auto',                            'width': elemWidth                        });                        $('.selectedElement').find('.elemContent').css({                            'height': 'auto',                            'width': 'auto'                        });                        setTimeout(function () {                            $.ajax({                                type: "POST",                                url: strUrlModuleHTML5 + "ajax/plaquespro_size.php",                                dataType: "json",                                data: {                                    action: 'getsize',                                    id: idCode,                                    elemWidth: parseInt($('.selectedElement').css('width'), 10),                                    elemHeight: parseInt($('.selectedElement').css('height'), 10),                                    ratio: $.data(document.body, 'ratioCfg'),                                    vitWidthpx: $('#plaque_content').width(),                                    vitHeightpx: $('#plaque_content').height(),                                    size: $.data(document.body, 'taillePlaque'),                                    type: 'text'                                },                                success: function (resultx) {                                    $('#' + idCode).parent('div.elementContainer').children('.imgL, .imgH').remove();                                    //$('#' + idCode).parent('div.elementContainer').append('<img class="imgL" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: -20px;left: 0;" src="data:image/png;base64,' + resultx['imgL'] + '" style="" /><img class="imgH" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: 0;left: -25px;" src="data:image/png;base64,' + resultx['imgH'] + '" style="" />');                                    $('#' + idCode).parent('div.elementContainer').append('<img class="imgL" data-elemSize="' + resultx['longueur'] + '" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: -20px;left: 0;" src="data:image/png;base64,' + resultx['imgL'] + '" style="" /><img class="imgH" data-elemSize="' + resultx['hauteur'] + '" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: 0;left: -25px;" src="data:image/png;base64,' + resultx['imgH'] + '" style="" />');                                    var thiscmHeight = $('#' + idCode).parent('div.elementContainer').find('img.imgH').attr('data-elemsize'),                                        thiscmWidth = $('#' + idCode).parent('div.elementContainer').find('img.imgL').attr('data-elemsize');                                    $('#elem_width').val(thiscmWidth);                                    $('#elem_height').val(thiscmHeight);                                    if ($('.selectedElement').hasClass('typeText')) {                                        $('.selectedElement').attr('fontattr', fontName);                                    }                                }                            });                        }, 100);                    }                });            }        }    });    setTimeout(function(){        $('#ddList-police').on("click",function(){            console.log('click:ddList-police');            $('#police').removeAttr('data-selected');        });    },100)    $('body').on('click', '.reset_rotate', function (e) {        e.preventDefault();        var parentDiv = $(this).parent('div');        parentDiv.center(true).css({            '-moz-transform': 'rotate(0deg)',            '-webkit-transform': 'rotate(0deg)',            '-o-transform': 'rotate(0deg)',            '-ms-transform': 'rotate(0deg)',            'transform': 'rotate(0deg)'        });    });    var hideResetBtn = true;    $('body').on({        mouseenter: function (e) {            var elem = $(this).siblings('.reset_rotate');            elem.fadeIn();            e.stopImmediatePropagation();            e.preventDefault();        },        mouseleave: function (e) {            var elem = $(this).siblings('.reset_rotate');            setTimeout(function () {                if (hideResetBtn)                    elem.fadeOut();            }, 1000);            e.stopImmediatePropagation();            e.preventDefault();//           var topcurrent= $(this).closest( ".elementContainer" ).css("top");//           var leftcurrent= $(this).closest( ".elementContainer" ).css("left");////           var anglecurrent = getRotationDegrees($(this).closest( ".elementContainer" ));//           console.log(Math.cos(anglecurrent));//           console.log(topcurrent.replace("px", ""));//           var y = topcurrent.replace("px", "")*Math.cos(anglecurrent) - leftcurrent.replace("px", "")*Math.sin(anglecurrent);//           var x = topcurrent.replace("px", "")*Math.sin(anglecurrent) + leftcurrent.replace("px", "")*Math.cos(anglecurrent);//           $(this).closest( ".elementContainer" ).attr("correctionx",x);//           $(this).closest( ".elementContainer" ).attr("correctiony",y);//           //            console.log(x);//            console.log(y);        }    }, '.ui-rotatable-handle');    $('body').on({        mouseenter: function (e) {            hideResetBtn = false;            e.stopImmediatePropagation();            e.preventDefault();        },        mouseleave: function (e) {            $('.reset_rotate').fadeOut();            e.stopImmediatePropagation();            e.preventDefault();        }    }, '.reset_rotate');    $('body').on('click', '.draggable', function (e) {        e.preventDefault();        $('.ctrlElem').hide();        $('.selectedElement').removeClass('selectedElement');        $(this).addClass('selectedElement');        var thiscmHeight = $(this).find('img.imgH').attr('data-elemsize'),            thiscmWidth = $(this).find('img.imgL').attr('data-elemsize');        $('#elem_width').val(thiscmWidth);        $('#elem_height').val(thiscmHeight);        $('input.elemSize').prop('disabled', false);        $('.selectedElement div.ctrlElem, .selectedElement .imgL, .selectedElement .imgH').show();        if ($(this).hasClass('typeText')) {            $.data(document.body, 'currentID', $(this).find('.plaque_element').attr('id'));            var attrVal = $(this).find('.elemContent').attr('alt');            $('#textecfg').val(attrVal).focus();            $('#colorpicker-element').stop(true).animate({                height: setcolorHeight            }, 200);            $('#elemColor').colpickSetColor($(this).find('.elemContent').attr('data-colorcode'));        } else if ($(this).hasClass('typeMotif')) {            $.data(document.body, 'currentID', $(this).find('.plaque_element').attr('id'));            $('#textecfg').val('');            document.getElementById("textecfgsize").value = 12;            $('#colorpicker-element').stop(true).animate({                height: setcolorHeight            }, 200);            $('#elemColor').colpickSetColor($(this).find('.elemContent').attr('data-colorcode'));        } else if ($(this).hasClass('typeImage')) {            $.data(document.body, 'currentID', $(this).find('.plaque_element').attr('id'));            $('#textecfg').val('');            $('#colorpicker-element').stop(true).animate({                height: 0            }, 200);        } else if ($(this).hasClass('typeFond') || $(this).hasClass('typeForme')) {            $.data(document.body, 'currentID', $(this).attr('id'));            $('#textecfg').val('');            $('#colorpicker-element').stop(true).animate({                height: setcolorHeight            }, 200);            $('#elemColor').colpickSetColor($(this).attr('data-colorcode'));        }        $('.ui-tabs-nav a[href="#element"]').trigger('click');    });    $('body').on('click', '.delete-element', function (e) {        e.preventDefault();        var elemSel = $(this);        var attrID = $(this).parent('div').find('.elemContent').attr('id');        if ($(this).parent('div').hasClass('typeText')) {            var type = 'text';        } else if ($(this).parent('div').hasClass('typeMotif')) {            var type = 'motif';        } else if ($(this).parent('div').hasClass('typeImage')) {            var type = 'image';        } else if ($(this).parent('div').hasClass('typeFond')) {            var attrID = $(this).parent('div').attr('id');            var type = 'fond';        } else if ($(this).parent('div').hasClass('typeForme')) {            var attrID = $(this).parent('div').attr('id');            var type = 'forme';        }        setTimeout(function () {            $.ajax({                type: "POST",                url: strUrlModuleHTML5 + "ajax/delete.php",                data: {                    action: 'delete',                    prodID: productID,                    typedel: type,                    id: attrID,                },                success: function (result) {                    //--------------------                    delOptionPrix(type);                    //--------------------                    elemSel.parent('div').remove();                    $('input.elemSize').prop('disabled', true).val('');                    $('*[data-object-id="' + attrID + '"]').remove();                    if ($.data(document.body, 'showColors')) {                        $('#colorpicker-element').stop(true).animate({                            height: setcolorHeight                        }, 200);                        $.data(document.body, 'showColors', false);                    } else {                        $('#colorpicker-element').stop(true).animate({                            height: 0                        }, 200);                    }                    //$('#textecfg').val('');                    $('ul#calques').sortable('refreshPositions');                    calculPrixTotal();                }            });        }, 100);    });    //---------- function del set prix ---------------    function delOptionPrix($type){        var dimension = $.data(document.body, 'taillePlaque');        var matiere = $.data(document.body, 'matiereVal');        switch($type){            case "image":                $.ajax({                    type: "POST",                    url: strUrlModuleHTML5 + "ajax/plaques_tailles.php",                    dataType: "json",                    data: {                        action: 'del_prix_image',                        type: $type,                        dimensionID : dimension,                        matiereID : matiere,                    },                    success: function(result){                        var prixHT = result['prix'];                        setPrixValuetoInput(prixHT);                    },                    error : function(resultat, statut, erreur){                        console.log(erreur);                    }                });                break;            default :                return;        }    }    //---------- function del set prix ----------------    $('ul#calques').sortable({        update: function (event, ui) {            var result = $(this).sortable('toArray', {                attribute: 'data-object-id'            });            result.reverse();            var newZindex = 2;            result.forEach(function (entry) {                if ($('#' + entry).get(0).tagName == 'DIV') {                    $('#' + entry).css('z-index', newZindex);                } else {                    $('#' + entry).parent('.elementContainer').css('z-index', newZindex);                }                newZindex++;            });            $(this).sortable('refreshPositions');        }    });//    $('#longueur, #hauteur').on('input', function() {//        var elemCount = $('#plaque_content > .elementContainer').length;//        if (elemCount >= 1 && setCfg) {//            swal({//                title: "Attention",//                text: "Vous perdrez votre travail si vous changez les dimensions de la plaque et vous devrez recommencer votre création",//                type: "warning",//                showCancelButton: true,//                confirmButtonColor: "#DD6B55",//                confirmButtonText: "Recommencer",//                cancelButtonText: "Annuler",//                closeOnConfirm: true,//                closeOnCancel: true//            }, function(isConfirm) {//                if (isConfirm) {//                    /*$('#calques > li').remove();//                    $('#plaque_content .elementContainer').remove();//                    $.post(strUrlModuleHTML5 + 'ajax/reset.php', function(data) {//                        $('#prix_ht span').html('0.00');//                        $('#prix_ttc span').html('0.00');//                    });//                    nbrElements = 0;//                    $.data(document.body, 'vWidth', 0);//                    $.data(document.body, 'vHeight', 0);*///                    $(window).unbind();//                    location.reload(true);//                    // return false;//                } else {//                    $('#longueur').val($.data(document.body, 'vWidth'));//                    $('#hauteur').val($.data(document.body, 'vHeight'));//                    //return false;//                }//            });//        }//    });    $('#sizes').change(function () {        if (this.checked) {            $('.imgL, .imgH').css('display', 'block');            showDim = true;        } else {            $('.imgL, .imgH').css('display', 'none');            showDim = false;        }    });    /*    $("#textecfgsize").change(function () {        console.log('trigger:textecfgsize');        $('.selectedElement').attr("fontsize", $("#textecfgsize").val());        $('#add_text').trigger("click");    });*/    $('#add_text').click(function (e) {        e.preventDefault();        var textVal = $('#textecfg').val();        $('.selectedElement').css("display", "none");        var dimensionssel = dimensionsp;        var parentSize = $('#plaque_content').css('width');        var supportWidth = $('#longueur').val();        var supportHeight = $('#hauteur').val();        if (textVal == '') {            swal({                title: "Attention",                text: "Vous devez saisir au moins un caractère avant de pouvoir continuer !",                type: "warning",                closeOnConfirm: true            });            return false;        } else if (setCfg == false) {            swal({                title: "Attention",                text: "Vous devez sélectionner les dimensions de votre plaque avant de pouvoir continuer !",                type: "warning",                closeOnConfirm: true            }, function () {                $('#longueur').effect('highlight', {                    color: '#c70077'                }, 1500);                $('input#longueur').focus();            });            return false;        } else {            var selElemWidth = $('.selectedElement').width();            var selElemHeight = $('.selectedElement').height();            if ($('.selectedElement').hasClass('typeText')) {                $.data(document.body, 'textEdit', true);                couleurVar = $('.selectedElement').find('img.elemContent').attr('data-ccode');                $('.selectedElement').attr('data-colorcode',couleurVar);            }            if (typeof $('.selectedElement').attr("fontsize") != "undefined") {                textecfgsize = $('.selectedElement').attr("fontsize");            } else {                textecfgsize = $("#textecfgsize").val();            }            $.ajax({                type: "POST",                url: strUrlModuleHTML5 + "ajax/plaquespro_text.php",                dataType: "json",                data: {                    action: 'update',                    text: encodeURIComponent(textVal),                    dimensions: dimensionssel,                    couleur: couleurVar,                    font: fontName,                    font1: fontName,                    fontsize: textecfgsize,                    ratio: $.data(document.body, 'ratioCfg'),                    size: $.data(document.body, 'taillePlaque'),                },                success: function (result) {                    if ($('.selectedElement').hasClass('typeText')) {                        var oldleftcontainer = $('.selectedElement').css("left");                        var oldtopcontainer = $('.selectedElement').css("top");                        var oldtransformcontainer = $('.selectedElement').css("transform");                        isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);                        if (isChrome){                            //var el = document.getElementsByClassName("selectedElement");                            //var st = window.getComputedStyle(el, null);                            //var tr = st.getPropertyValue("-webkit-transform") ||                            //         st.getPropertyValue("-moz-transform") ||                            //         st.getPropertyValue("-ms-transform") ||                            //         st.getPropertyValue("-o-transform") ||                            //         st.getPropertyValue("transform") ||                            //         "FAIL";                            // With rotate(30deg)...                            // matrix(0.866025, 0.5, -0.5, 0.866025, 0px, 0px)                            //console.log('Matrix: ' + tr);                            oldtransformcontainer = $('.selectedElement').css("-webkit-transform");                            console.log("transform "+oldtransformcontainer);                        }                        var oldwidthcolor = couleurVar;                        $('.selectedElement').find('.delete-element').trigger('click');                        $.data(document.body, 'showColors', true);                    }                    $('.selectedElement').removeClass('selectedElement');                    $('#plaque_content').append('<div id="element_content" fontsize=' + textecfgsize + ' fontattr=' + fontName + ' class="elementContainer typeText resizable draggable rotatable hidelem" data-colorcode="'+ result['color'] +'" style="position:absolute; max-width:90%;"><div class="reset_rotate ctrlElem" title="Réinitialiser la position de l\'élement"></div><img class="plaque_element elemContent" src="data:image/png;base64,' + result['image'] + '" data-ccode="' + result['color'] + '" data-colorcode="' + result['color'] + '" alt="' + result['text'] + '" id="' + result['id'] + '" /><div class="ctrlElem seresizer ui-resizable-handle ui-resizable-se"></div><div class="delete-element ctrlElem" title="Supprimer l\'élément"></div></div>');                    $('.selectedElement').hide();                    $('#colorpicker-element').stop(true).animate({                        height: setcolorHeight                    }, 200);                    $('#' + result['id']).parent('div').addClass('selectedElement');                    showfirstElem();                    $('.selectedElement').find('.elemContent').attr('data-colorcode', couleurVar);                    $('input.elemSize').prop('disabled', false);                    setTimeout(function () {                        var maxWidth = $('#plaque_content').width() - 50;                        var maxHeight = $('#plaque_content').height() - 50;                        var ratio = 0;                        var width = $('.selectedElement .elemContent').width();                        var height = $('.selectedElement .elemContent').height();                        if (typeof oldtopcontainer != "undefined" && typeof oldleftcontainer != "undefined") {                            $('.selectedElement').css("top", oldtopcontainer);                            $('.selectedElement').css("left", oldleftcontainer);                            $('.selectedElement').css("transform", oldtransformcontainer);                            $('.selectedElement').css('-webkit-transform','oldtransformcontainer');                            console.log('rotate('+oldtransformcontainer+'deg)');//                            $('.selectedElement').css("height",oldheightcontainer);//                            $('.selectedElement').css("width",oldwidthcontainer);                            $('.selectedElement').css("position", "absolute");                            //$('.selectedElement').css("display", "block");                        }                        else {                            if (width > maxWidth) {                                ratio = maxWidth / width;                                $('.selectedElement, .selectedElement .elemContent').css("width", maxWidth);                                $('.selectedElement, .selectedElement .elemContent').css("height", height * ratio);                                height = height * ratio;                                width = width * ratio;                            }                            if (height > maxHeight) {                                ratio = maxHeight / height;                                $('.selectedElement, .selectedElement .elemContent').css("height", maxHeight);                                $('.selectedElement, .selectedElement .elemContent').css("width", width * ratio);                                width = width * ratio;                                height = height * ratio;                            }                            //$('.selectedElement').css("display", "block");                            $('.selectedElement').center(true);                        }                    }, 10);                    if (textVal.length <= 10 && textVal.length > 1) {                        var newSize = parseInt(parentSize) / 4;                    } else if (textVal.length > 10 && textVal.length <= 20) {                        var newSize = parseInt(parentSize) / 2;                    } else if (textVal.length > 21) {                        var newSize = parseInt(parentSize) / 1.3;                    } else if (textVal.length == 1) {                        var newSize = 110;                    }                    var $oSelectedElement = $(".selectedElement");                    //if (typeof oldtopcontainer == "undefined" && typeof oldleftcontainer == "undefined") {						var $textDimensionCalculation = $(".textDimensionCalculation");	                    var policeName = $("#police").val().split('.')[0];	                    $textDimensionCalculation.html(textVal);	                    $textDimensionCalculation.css({	                        'font-family' :  policeName	                    });	                    setTimeout(function(){	                        var newWidth = $textDimensionCalculation.outerWidth();	                        var newHeight = $textDimensionCalculation.outerHeight();	                        console.warn("w:" + newWidth);	                        console.warn("h:" + newHeight);	                        $oSelectedElement.width(newWidth);	                        $oSelectedElement.height('auto');	                        $oSelectedElement.center(true);	                    },200)                        //$('.selectedElement').height('auto').width(newSize);                    //}                    setTimeout(function(){                        $oSelectedElement.show();                    },100)                    var nbrLayers = $('ul#calques li').length;                    var newLayer = parseInt(nbrLayers) + 1;                    zIndex = zIndex + 1;                    $('.selectedElement').css('z-index', zIndex);                    $('ul#calques').prepend('<li data-zindex="' + zIndex + '" data-object-id="' + result['id'] + '" class="ui-state-default"><span class="text">' + textVal + '</span><span class="layer">calque ' + newLayer + '</span></li>');                    $('#textecfg').val(textVal);                    $('ul#calques').sortable('refresh');                    $('.ctrlElem, .imgL, .imgH').hide();                    $('.selectedElement div.ctrlElem').show();                    $('.selectedElement div.reset_rotate').hide();                    doDraggable();                    doResizable();                    doRotatable();                    if (!$.data(document.body, 'textEdit'))                        $('#' + result['id']).parent('div').center(true);                    $.data(document.body, 'currentID', result['id']);                    setTimeout(function () {                        if ($('.selectedElement').width() <= 0) {                            var width = $('.selectedElement .elemContent').width();                            console.log(width);                            var height = $('.selectedElement .elemContent').height();                            console.log(height);                            $('.selectedElement').height(height).width(width);                        }                        $.ajax({                            type: "POST",                            url: strUrlModuleHTML5 + "ajax/plaquespro_size.php",                            dataType: "json",                            data: {                                action: 'getsize',                                id: result['id'],                                elemWidth: $('.selectedElement').width(),                                elemHeight: $('.selectedElement').height(),                                ratio: $.data(document.body, 'ratioCfg'),                                vitWidthpx: $('#plaque_content').width(),                                vitHeightpx: $('#plaque_content').height(),                                size: $.data(document.body, 'taillePlaque'),                                type: 'text'                            },                            success: function (resultx) {                                $.data(document.body, 'currentID', result['id']);                                //$('#' + result['id']).parent('div.elementContainer').append('<img class="imgL" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: -20px;left: 0;" src="data:image/png;base64,' + resultx['imgL'] + '" style="" /><img class="imgH" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: 0;left: -25px;" src="data:image/png;base64,' + resultx['imgH'] + '" style="" />');                                $('#' + result['id']).parent('div.elementContainer').append('<img class="imgL" data-elemSize="' + resultx['longueur'] + '" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: -20px;left: 0;" src="data:image/png;base64,' + resultx['imgL'] + '" style="" /><img class="imgH" data-elemSize="' + resultx['hauteur'] + '" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: 0;left: -25px;" src="data:image/png;base64,' + resultx['imgH'] + '" style="" />');                                var thiscmHeight = $('#' + result['id']).parent('div.elementContainer').find('img.imgH').attr('data-elemsize'),                                    thiscmWidth = $('#' + result['id']).parent('div.elementContainer').find('img.imgL').attr('data-elemsize');                                $('#elem_width').val(thiscmWidth);                                $('#elem_height').val(thiscmHeight);                            }                        });                    }, 300);                }            });            $.data(document.body, 'textEdit', false);        }    });    $('body').on('click', '.motif', function () {        var supportWidth = $('#longueur').val();        var supportHeight = $('#hauteur').val();        var motifUrl = $(this).attr('id');        if (setCfg == false) {            swal({                title: "Attention",                text: "Vous devez sélectionner les dimensions de votre plaque avant de pouvoir continuer !",                type: "warning",                closeOnConfirm: true            }, function () {                $('#longueur').effect('highlight', {                    color: '#c70077'                }, 1500);                $('input#longueur').focus();            });            return false;        }        $('#textecfg').val('');        document.getElementById("textecfgsize").value = 12;        $.ajax({            type: "POST",            url: strUrlModuleHTML5 + "ajax/plaquespro_motif.php",            dataType: "json",            data: {                action: 'update',                motif: motifUrl,                folder: theme,                couleur: couleurVar,                ratio: $.data(document.body, 'ratioCfg'),                size: $.data(document.body, 'taillePlaque'),            },            success: function (result) {                console.log('plaque pro motif result');                $('.selectedElement').removeClass('selectedElement');                var srcvalue = "";                if (result['svg'] == "1") {                    srcvalue = result['imgMotif'];                }                else {                    srcvalue = 'data:image/png;base64,' + result['imgMotif'];                }                $('#plaque_content').append('<div class="elementContainer typeMotif resizable draggable rotatable" style="position:absolute"><div class="reset_rotate ctrlElem" title="Réinitialiser la position de l\'élement"></div><img class="elemContent plaque_element" data-src-code="' + result['code'] + '" src="' + srcvalue + '" alt="' + result['motif'] + '" id="' + result['id'] + '" /><div class="ctrlElem seresizer ui-resizable-handle ui-resizable-se"></div><div class="ctrlElem delete-element" title="Supprimer l\'élément"></div></div>');                $('#' + result['id']).parent('div').addClass('selectedElement');                showfirstElem();                if( $("#matiere").val() == '13' ){                    $('#elemColor').colpickSetColor(couleurVar);                    $('.selectedElement').find('.elemContent').attr('data-colorcode', couleurVar);                }else{                    $('#elemColor').colpickSetColor('#000000');                    $('.selectedElement').find('.elemContent').attr('data-colorcode', '#000000');                }                $('input.elemSize').prop('disabled', false);                setTimeout(function () {                    var maxWidth = $('#plaque_content').width() - 50;                    var maxHeight = $('#plaque_content').height() - 50;                    var ratio = 0;                    var width = $('.selectedElement img.elemContent').width();                    var height = $('.selectedElement img.elemContent').height();                    if (width > maxWidth) {                        ratio = maxWidth / width;                        $('.selectedElement, .selectedElement img.elemContent').css("width", maxWidth);                        $('.selectedElement, .selectedElement img.elemContent').css("height", height * ratio);                        height = height * ratio;                        width = width * ratio;                    }                    if (height > maxHeight) {                        ratio = maxHeight / height;                        $('.selectedElement, .selectedElement img.elemContent').css("height", maxHeight);                        $('.selectedElement, .selectedElement img.elemContent').css("width", width * ratio);                        width = width * ratio;                        height = height * ratio;                    }                    $('.selectedElement').center(true);                }, 10);                $('#colorpicker-element').stop(true).animate({                    height: setcolorHeight                }, 200);                var nbrLayers = $('ul#calques li').length;                var newLayer = parseInt(nbrLayers) + 1;                zIndex = zIndex + 1;                $('.selectedElement').css('z-index', zIndex);                var motif_ = "";                if (result['svg'] == "1") {                    motif_ = srcvalue;                } else {                    motif_ = result['motif'];                }                $('ul#calques').prepend('<li data-zindex="' + zIndex + '" data-object-id="' + result['id'] + '" class="ui-state-default"><img style="width:25px" data-src-code="' + result['code'] + '" src="' + motif_ + '" alt="' + result['motif'] + '" /> <span class="layer">calque ' + newLayer + '</span></li>');                $('ul#calques').sortable('refresh');                $('.ctrlElem, .imgL, .imgH').hide();                $('.selectedElement div.ctrlElem').show();                $('.selectedElement div.reset_rotate').hide();                doDraggable();                doResizable();                doRotatable();                $('#' + result['id']).parent('div').center(true);                $.data(document.body, 'currentID', result['id']);                setTimeout(function () {                    $.ajax({                        type: "POST",                        url: strUrlModuleHTML5 + "ajax/plaquespro_size.php",                        dataType: "json",                        data: {                            action: 'getsize',                            id: result['id'],                            elemWidth: parseInt($('.selectedElement').css('width'), 10),                            elemHeight: parseInt($('.selectedElement').css('height'), 10),                            ratio: $.data(document.body, 'ratioCfg'),                            vitWidthpx: $('#plaque_content').width(),                            vitHeightpx: $('#plaque_content').height(),                            size: $.data(document.body, 'taillePlaque'),                            type: 'motif'                        },                        success: function (resultx) {                            //$('#' + result['id']).parent('div.elementContainer').append('<img class="imgL" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: -20px;left: 0;" src="data:image/png;base64,' + resultx['imgL'] + '" style="" /><img class="imgH" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: 0;left: -25px;" src="data:image/png;base64,' + resultx['imgH'] + '" style="" />');                            $('#' + result['id']).parent('div.elementContainer').append('<img class="imgL" data-elemSize="' + resultx['longueur'] + '" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: -20px;left: 0;" src="data:image/png;base64,' + resultx['imgL'] + '" style="" /><img class="imgH" data-elemSize="' + resultx['hauteur'] + '" style="' + ((!showDim) ? 'display:none;' : 'display:block;') + 'position: absolute;bottom: 0;left: -25px;" src="data:image/png;base64,' + resultx['imgH'] + '" style="" />');                            var thiscmHeight = $('#' + result['id']).parent('div.elementContainer').find('img.imgH').attr('data-elemsize'),                                thiscmWidth = $('#' + result['id']).parent('div.elementContainer').find('img.imgL').attr('data-elemsize');                            $('#elem_width').val(thiscmWidth);                            $('#elem_height').val(thiscmHeight);                        }                    });                }, 100);            }        });    });    $(document).keydown(function (e) {        if ($('.selectedElement')[0]) {            var elemZ = $('.selectedElement'),                parentZ = $('#plaque_content'),                elemPosition = elemZ.position(),                parentPosition = parentZ.position(),                elemWidth = elemZ.width() + 2,                elemHeight = elemZ.height() + 2,                parentWidth = parentZ.width(),                parentHeight = parentZ.height();            switch (e.which) {                case 37: // left                    if (elemPosition.left > 2)                        $('.selectedElement').css('left', '-=2px');                    break;                case 38: // up                    if (elemPosition.top > 2)                        $('.selectedElement').css('top', '-=2px')                    break;                case 39: // right                    var positionRight = elemPosition.left + elemWidth;                    if (positionRight < (parentWidth - 4))                        $('.selectedElement').css('left', '+=2px')                    break;                case 40: // down                    var positionBottom = elemPosition.top + elemHeight;                    if (positionBottom < (parentHeight - 4))                        $('.selectedElement').css('top', '+=2px')                    break;                case 46: // delete                    var elemSel = $('.selectedElement');                    var attrID = $('.selectedElement').find('.elemContent').attr('id');                    if ($('.selectedElement').hasClass('typeText')) {                        var type = 'text';                    } else if ($('.selectedElement').hasClass('typeMotif')) {                        var type = 'motif';                    } else if ($('.selectedElement').hasClass('typeImage')) {                        var type = 'image';                    } else if ($('.selectedElement').hasClass('typeFond')) {                        var attrID = $('.selectedElement').attr('id');                        var type = 'fond';                    } else if ($('.selectedElement').hasClass('typeForme')) {                        var attrID = $('.selectedElement').attr('id');                        var type = 'forme';                    }                    setTimeout(function () {                        $.ajax({                            type: "POST",                            url: strUrlModuleHTML5 + "ajax/delete.php",                            data: {                                action: 'delete',                                prodID: productID,                                typedel: type,                                id: attrID                            },                            success: function (result) {                                $('.selectedElement').remove();                                $('input.elemSize').prop('disabled', true).val('');                                $('*[data-object-id="' + attrID + '"]').remove();                                if ($.data(document.body, 'showColors')) {                                    $('#colorpicker-element').stop(true).animate({                                        height: 130                                    }, 200);                                    $.data(document.body, 'showColors', false);                                } else {                                    $('#colorpicker-element').stop(true).animate({                                        height: 0                                    }, 200);                                }                                $('#textecfg').val('');                                document.getElementById("textecfgsize").value = 12;                                $('ul#calques').sortable('refreshPositions');                                calculPrixTotal();                            }                        });                    }, 100);                    break;                default:                    return;            }            e.preventDefault();        }    });    $('.alignmove').repeatedclick(function (e) {        e.preventDefault();        var elemZ = $('.selectedElement'),            parentZ = $('#plaque_content'),            elemPosition = elemZ.position(),            parentPosition = parentZ.position(),            elemWidth = elemZ.width() + 2,            elemHeight = elemZ.height() + 2,            parentWidth = parentZ.width(),            parentHeight = parentZ.height();        switch ($(this).attr('id')) {            /*case 'flip_vertical':             if (!$('.selectedElement').hasClass('typeFond')) {             if ($('.selectedElement .elemContent').hasClass('flipVertical')) $('.selectedElement .elemContent').removeClass('flipVertical');             else $('.selectedElement .elemContent').addClass('flipVertical');             }             break;*/            case 'center_h':                $('.selectedElement').centerH(true);                break;            case 'center_v':                $('.selectedElement').centerV(true);                break;            case 'center':                $('.selectedElement').center(true);                break;            case 'move_left':                if (elemPosition.left > 2)                    $('.selectedElement').css('left', '-=2px');                break;            case 'move_right':                var positionRight = elemPosition.left + elemWidth;                if (positionRight < (parentWidth - 4))                    $('.selectedElement').css('left', '+=2px')                break;            case 'move_top':                if (elemPosition.top > 2)                    $('.selectedElement').css('top', '-=2px')                break;            case 'move_bottom':                var positionBottom = elemPosition.top + elemHeight;                if (positionBottom < (parentHeight - 4))                    $('.selectedElement').css('top', '+=2px')                break;            /*case 'flip_vertical':             $('.selectedElement').animate({             rotate: 180             });             break;*/            /*case 'flip_horizontal':             if ($('.selectedElement .elemContent').hasClass('flipHorizontal')) $('.selectedElement .elemContent').removeClass('flipHorizontal');             else $('.selectedElement .elemContent').addClass('flipHorizontal');             break;*/        }    }, {        duration: 100,        speed: 0.8,        min: 500    });    $("#flip_vertical").click(function () {        if ($('.selectedElement .elemContent').hasClass('flipVertical')) {            $('.selectedElement .elemContent').removeClass('flipVertical');        } else {            $('.selectedElement .elemContent').addClass('flipVertical');        }    });    $("#flip_horizontal").click(function () {        if ($('.selectedElement .elemContent').hasClass('flipHorizontal'))            $('.selectedElement .elemContent').removeClass('flipHorizontal');        else            $('.selectedElement .elemContent').addClass('flipHorizontal');    });    $('.colorblock').click(function () {        var color = $(this).attr('data-hexcolor');        $('#elemColor').colpickSetColor(color);        couleurVar = color;        console.log("trigger:colorblock");        var supportWidth = $('#longueur').val();        var supportHeight = $('#hauteur').val();        if ($('.selectedElement').hasClass('typeMotif')) {            var elementChange = $('.selectedElement').find('.elemContent');            var srcCode = elementChange.attr('data-src-code');            var idCode = elementChange.attr('id');            $.ajax({                type: "POST",                url: strUrlModuleHTML5 + "ajax/color2png.php",                data: {                    fileName: srcCode,                    prodID: productID,                    folder: theme,                    fileColor: color,                    id: idCode,                    ratio: $.data(document.body, 'ratioCfg'),                    size: $.data(document.body, 'taillePlaque'),                },                success: function (result) {                    var newSRC = "";                    var IS_JSON = true;                    try                    {                        parse = JSON.parse(result);                    }                    catch (err)                    {                        IS_JSON = false;                    }                    if (IS_JSON) {                        parse = JSON.parse(result);                        if (parse.svg) {                            newSRC = parse.imgMotif;                            $("#svgblock").html(parse.contentsvg);                        }                    }                    else                        newSRC = 'data:image/gif;base64,' + result;                    elementChange.attr('src', newSRC);                    console.log("newattr");                    elementChange.attr('data-colorcode', color);                    elementChange.parent().attr('data-colorcode', color);                }            });        } else if ($('.selectedElement').hasClass('typeText')) {            var elementChange = $('.selectedElement').find('.elemContent');            var idCode = elementChange.attr('id');            var altCode = elementChange.attr('alt');            var dimensionssel = $('#dimensionssel').val();            $('.selectedElement').find('img.elemContent').attr('data-ccode', color);            if ($('.selectedElement').attr("fontsize") != "undefined") {                textecfgsize = $('.selectedElement').attr("fontsize");                //document.getElementById("textecfgsize").value = textecfgsize;            } else {                textecfgsize = $("#textecfgsize").val();            }            $.ajax({                type: "POST",                dataType: "json",                url: strUrlModuleHTML5 + "ajax/plaquespro_text.php",                data: {                    action: 'update',                    text: encodeURIComponent(altCode),                    dimensions: dimensionssel,                    couleur: color,                    font: fontName,                    font2: fontName,                    fontsize: textecfgsize,                    id: idCode,                    ratio: $.data(document.body, 'ratioCfg'),                    size: $.data(document.body, 'taillePlaque'),                },                success: function (result) {                    elementChange.attr('src', 'data:image/png;base64,' + result['image']);                    elementChange.attr('data-colorcode', color);                    elementChange.parent().attr('data-colorcode', color);                }            });        } else if ($('.selectedElement').hasClass('typeFond')) {            var elementChange = $('.selectedElement');            var idCode = elementChange.attr('id');            $.ajax({                type: "POST",                dataType: "json",                url: strUrlModuleHTML5 + "ajax/plaquespro_fond.php",                data: {                    action: 'update',                    couleur: color,                    type: 'fond',                    id: idCode,                    ratio: $.data(document.body, 'ratioCfg'),                    size: $.data(document.body, 'taillePlaque'),                },                success: function (result) {                    $('.selectedElement').css('background-color', color);                }            });        } else if ($('.selectedElement').hasClass('typeForme')) {            var elementChange = $('.selectedElement');            var idCode = elementChange.attr('id');            $.ajax({                type: "POST",                dataType: "json",                url: strUrlModuleHTML5 + "ajax/plaquespro_forme.php",                data: {                    action: 'update',                    couleur: color,                    type: 'forme',                    id: idCode,                    ratio: $.data(document.body, 'ratioCfg'),                    size: $.data(document.body, 'taillePlaque'),                },                success: function (result) {                    $('.selectedElement').css('background-color', color);                }            });        }    });    $('#elemColor').colpick({        flat: true,        color: '000000',        layout: 'hex',        submit: 0,        onChange: function (hsb, hex, rgb, el, bySetColor) {            console.log('colpick onchange');            if (!bySetColor) {                var color = '#' + hex;                couleurVar = color;                var supportWidth = $('#longueur').val();                var supportHeight = $('#hauteur').val();                if ($('.selectedElement').hasClass('typeMotif')) {                    var elementChange = $('.selectedElement').find('.elemContent');                    var srcCode = elementChange.attr('data-src-code');                    var idCode = elementChange.attr('id');                    $.ajaxq.abort('plaquespro');                    $.ajaxq("plaquespro", {                        type: "POST",                        url: strUrlModuleHTML5 + "ajax/color2png.php",                        data: {                            fileName: srcCode,                            folder: theme,                            prodID: productID,                            fileColor: color,                            id: idCode,                            ratio: $.data(document.body, 'ratioCfg'),                            size: $.data(document.body, 'taillePlaque'),                        },                        success: function (result) {                            var newSRC = "";                            var IS_JSON = true;                            try                            {                                parse = JSON.parse(result);                            }                            catch (err)                            {                                IS_JSON = false;                            }                            if (IS_JSON) {                                parse = JSON.parse(result);                                if (parse.svg) {                                    newSRC = parse.imgMotif;                                    $("#svgblock").html(parse.contentsvg);                                }                            }                            else                                newSRC = 'data:image/gif;base64,' + result;                            elementChange.attr('src', newSRC);                            elementChange.attr('data-colorcode', color);                            elementChange.parent().attr('data-colorcode', color);                        }                    });                } else if ($('.selectedElement').hasClass('typeText')) {                    console.log('type text select');                    var elementChange = $('.selectedElement').find('.elemContent');                    var idCode = elementChange.attr('id');                    var altCode = elementChange.attr('alt');                    var dimensionssel = $('#dimensionssel').val();                    $('.selectedElement').find('img.elemContent').attr('data-ccode', color);                    $.ajaxq.abort('plaquespro');                    if ($('.selectedElement').attr("fontsize") != "undefined") {                        textecfgsize = $('.selectedElement').attr("fontsize");                        //document.getElementById("textecfgsize").value = textecfgsize;                    } else {                        textecfgsize = $("#textecfgsize").val();                    }                    $.ajaxq("plaquespro", {                        type: "POST",                        dataType: "json",                        url: strUrlModuleHTML5 + "ajax/plaquespro_text.php",                        data: {                            action: 'update',                            text: encodeURIComponent(altCode),                            dimensions: dimensionssel,                            couleur: color,                            font: fontName,                            font3: fontName,                            fontsize: textecfgsize,                            id: idCode,                            ratio: $.data(document.body, 'ratioCfg'),                            size: $.data(document.body, 'taillePlaque'),                        },                        success: function (result) {                            elementChange.attr('src', 'data:image/png;base64,' + result['image']);                            elementChange.attr('data-colorcode', color);                            elementChange.parent().attr('data-colorcode', color);                        }                    });                } else if ($('.selectedElement').hasClass('typeFond')) {                    var elementChange = $('.selectedElement');                    var idCode = elementChange.attr('id');                    $.ajaxq.abort('plaquespro');                    $.ajaxq("plaquespro", {                        type: "POST",                        dataType: "json",                        url: strUrlModuleHTML5 + "ajax/plaquespro_fond.php",                        data: {                            action: 'update',                            couleur: color,                            type: 'fond',                            id: idCode,                            ratio: $.data(document.body, 'ratioCfg'),                            size: $.data(document.body, 'taillePlaque'),                        },                        success: function (result) {                            $('.selectedElement').css('background-color', color);                        }                    });                } else if ($('.selectedElement').hasClass('typeForme')) {                    var elementChange = $('.selectedElement');                    var idCode = elementChange.attr('id');                    $.ajaxq.abort('plaquespro');                    $.ajaxq("plaquespro", {                        type: "POST",                        dataType: "json",                        url: strUrlModuleHTML5 + "ajax/plaquespro_forme.php",                        data: {                            action: 'update',                            couleur: color,                            type: 'forme',                            id: idCode,                            ratio: $.data(document.body, 'ratioCfg'),                            size: $.data(document.body, 'taillePlaque'),                        },                        success: function (result) {                            $('.selectedElement').css('background-color', color);                            elementChange.attr('data-colorcode', color);                            elementChange.parent().attr('data-colorcode', color);                        }                    });                }            } else {                //$(el).val(hex);                var color = '#' + hex;                couleurVar = color;                var supportWidth = $('#longueur').val();                var supportHeight = $('#hauteur').val();                if ($('.selectedElement').hasClass('typeMotif')) {                    var elementChange = $('.selectedElement').find('.elemContent');                    var srcCode = elementChange.attr('data-src-code');                    var idCode = elementChange.attr('id');                    $.ajaxq.abort('plaquespro');                    $.ajaxq("plaquespro", {                        type: "POST",                        url: strUrlModuleHTML5 + "ajax/color2png.php",                        data: {                            fileName: srcCode,                            folder: theme,                            prodID: productID,                            fileColor: color,                            id: idCode,                            ratio: $.data(document.body, 'ratioCfg'),                            size: $.data(document.body, 'taillePlaque'),                        },                        success: function (result) {                            var newSRC = "";                            var IS_JSON = true;                            try                            {                                parse = JSON.parse(result);                            }                            catch (err)                            {                                IS_JSON = false;                            }                            if (IS_JSON) {                                parse = JSON.parse(result);                                if (parse.svg) {                                    newSRC = parse.imgMotif;                                    $("#svgblock").html(parse.contentsvg);                                }                            }                            else                                newSRC = 'data:image/gif;base64,' + result;                            elementChange.attr('src', newSRC);                            elementChange.attr('data-colorcode', color);                            elementChange.parent().attr('data-colorcode', color);                        }                    });                } else if ($('.selectedElement').hasClass('typeText')) {                    console.log('type text select');                    var elementChange = $('.selectedElement').find('.elemContent');                    var idCode = elementChange.attr('id');                    var altCode = elementChange.attr('alt');                    var dimensionssel = $('#dimensionssel').val();                    $('.selectedElement').find('img.elemContent').attr('data-ccode', color);                    // alert("111");                    if (typeof $('.selectedElement').attr("fontsize") != "undefined") {                        textecfgsize = $('.selectedElement').attr("fontsize");                        $("#textecfgsize").val(textecfgsize);                        $('#police').attr('data-selected','false');                        $('#police').ddlist('select', {value: $('.selectedElement').attr("fontattr")});                    } else {                        textecfgsize = $("#textecfgsize").val();                    }                    /* if ($('.selectedElement').attr("fontsize") != "undefined") {                     textecfgsize = $('.selectedElement').attr("fontsize");                     var textecfgname = $('.selectedElement').attr("fontattr");                     console.log(">>>>>>>> " + textecfgname);                     //document.getElementById("textecfgsize").value = textecfgsize;                     console.log("fontsize"+textecfgsize);                     $("#textecfgsize").val(textecfgsize);                     //$("#police").val(textecfgname);                     $('#police').ddlist('select', {value: textecfgname});                     } else {                     textecfgsize = $("#textecfgsize").val();                     }*///                    //                    $.ajaxq.abort('plaquespro');//                    $.ajaxq("plaquespro", {//                        type: "POST",//                        dataType: "json",//                        url: strUrlModuleHTML5 + "ajax/plaquespro_text.php",//                        data: {//                            action: 'update',//                            text: encodeURIComponent(altCode),//                            dimensions: dimensionssel,//                            couleur: color,//                            font: textecfgname,////                            font6: textecfgname,//                            fontsize: textecfgsize,//                            id: idCode,//                            ratio: $.data(document.body, 'ratioCfg'),//                            size: $.data(document.body, 'taillePlaque'),//                        },//                        success: function (result) {//                            elementChange.attr('src', 'data:image/png;base64,' + result['image']);//                            elementChange.attr('data-colorcode', color);//                            elementChange.parent().attr('data-colorcode', color);//                        }//                    });                } else if ($('.selectedElement').hasClass('typeFond')) {                    var elementChange = $('.selectedElement');                    var idCode = elementChange.attr('id');                    $.ajaxq.abort('plaquespro');                    $.ajaxq("plaquespro", {                        type: "POST",                        dataType: "json",                        url: strUrlModuleHTML5 + "ajax/plaquespro_fond.php",                        data: {                            action: 'update',                            couleur: color,                            type: 'fond',                            id: idCode,                            ratio: $.data(document.body, 'ratioCfg'),                            size: $.data(document.body, 'taillePlaque'),                        },                        success: function (result) {                            $('.selectedElement').css('background-color', color);                        }                    });                } else if ($('.selectedElement').hasClass('typeForme')) {                    var elementChange = $('.selectedElement');                    var idCode = elementChange.attr('id');                    $.ajaxq.abort('plaquespro');                    $.ajaxq("plaquespro", {                        type: "POST",                        dataType: "json",                        url: strUrlModuleHTML5 + "ajax/plaquespro_forme.php",                        data: {                            action: 'update',                            couleur: color,                            type: 'forme',                            id: idCode,                            ratio: $.data(document.body, 'ratioCfg'),                            size: $.data(document.body, 'taillePlaque'),                        },                        success: function (result) {                            $('.selectedElement').css('background-color', color);                            elementChange.attr('data-colorcode', color);                            elementChange.parent().attr('data-colorcode', color);                        }                    });                }            }        }    }).keyup(function () {        $(this).colpickSetColor(this.value);    });    $('#elemColor .colpick_hex_field').children($("input")).keyup(function (e) {        if (e.keyCode == 13) {            // Ok je passe là, maintenant il faut que ça change la couleur de l'élément            $('#elemColor').colpickSetColor($(this).val());        }    });    $('#elemColor .colpick_hex_field').children($("input")).blur(function (e) {        // Ok je passe là, maintenant il faut que ça change la couleur de l'élément        //alert($(this).val());        $('#elemColor').colpickSetColor($(this).val());    });    $('#colorpicker-fond .colorblock').click(function () {        var color = $(this).attr('data-hexcolor');        $('#plaque_content').css('background-color', '#' + color);    });    $('#fondColor').colpick({        flat: true,        layout: 'hex',        color: 'cccccc',        submit: 0,        onChange: function (hsb, hex, rgb, el, bySetColor) {            $('#plaque_content').css('background-color', '#' + hex);        }    }).keyup(function () {        $(this).colpickSetColor(this.value);    });    $('.colorfondblock').click(function () {        var color = $(this).attr('data-hexcolor');        $.data(document.body, 'couleurFond', color);        $('#plaque_content').css('background-color', color);        $('#fondColor').colpickSetColor(color);    });    /** ---------- Add to cart ------------ **/    $("#addpanier_button").click(function() {        console.log('addpanier button');        $('.selectedElement div.ctrlElem, .selectedElement .imgL, .selectedElement .imgH').hide();        $('.selectedElement').removeClass('selectedElement');        $('input.elemSize').prop('disabled', true).val('');        $('#colorpicker-element').stop(true).animate({            height: 0        }, 200);        $('#textecfg').val('');        setTimeout(function(){            console.log("1");            html2canvas($("#plaque_content"),{                onrendered: function( canvas ) {                    var imgCanvas = canvas.toDataURL();                    $.ajax({                        type: "POST",                        async: false,                        url: "./html5/ajax/postScrn.php",                        data: {                            imageCanvas: imgCanvas                        },                        success: function(result){                            console.log('success postScrn');                            var prixHT = $("#prix_ht span").html();                            var prixTTC = $("#prix_ttc span").html();                            var artid = $("#artid_module").val();                            var dimTxt = $("#dimensionssel option:selected").text();                            var longueur = dimTxt.substr(0,2);                            var hauteur = dimTxt.substr(3,3);                            var urlImage = result;                            $("#add_prix_ht").val(prixHT);                            $("#add_prix_ttc").val(prixTTC);                            $("#add_artid").val(artid);                            $("#add_longueur").val(longueur);                            $("#add_hauteur").val(hauteur);                            $("#add_url_image").val(urlImage);                            getImage(7);                            /**                             * @author RV                             * @date 2017-02-28                             * disable when add to cart option                             **/                            /** generatePdf('cart'); */                            $("#formu_add_panier_plaquespro").submit();                        }                    });                }            });        },200);    });    /** ---------- Add to cart ------------ **/    /** --- get all image uploaded by User --- **/    function getImage($moduleId){        $.ajax({            type: "POST",            dataType : 'json',            url: "./html5/ajax/image_provider.php",            data: {                action : "getImage",                moduleId : $moduleId            },            success: function(result){                //console.log(">>>> " + result['imageData'] );                $("#add_url_image_uploaded").val(result['imageData']);            },            error : function(data){                console.log(data);            }        });    }    /** --- get all image uploaded by User --- **/    /** ---------- START - function set prix ------- **/    function calculPrix($type){        var matiereId = parseInt($.data(document.body, 'matiereVal'));        var dimensionId = parseInt($.data(document.body, 'taillePlaque'));        switch ($type) {            case 'image':                $.ajax({                    type: "POST",                    url: strUrlModuleHTML5 + "ajax/plaquespro_prix_regle.php",                    dataType: "json",                    data: {                        action: 'prix_image',                        type: 'image',                        dimension_id : dimensionId,                        maitere_id : matiereId                    },                    success: function(result){                        setPrixValuetoInput(result.prix_image);                    },                    error : function(result, statut, erreur){                        console.log(erreur);                    }                });                break ;            case 'no_fixing':                //---------------- warning plaque dimension --------------                if ( $('#dimensionssel option:selected').val() == '0') {                    swal({                        title: "Attention",                        text: "Vous devez saisir au moins choisir une dimension avant de pouvoir continuer !",                        type: "warning",                        closeOnConfirm: true                    });                    return false;                }                //---------------- warning plaque dimension --------------                var dimensionSelected = $('#dimensionssel option:selected').val();                $.ajax({                    type: "POST",                    url: strUrlModuleHTML5 + "ajax/plaquespro_prix_regle.php",                    dataType: "json",                    data: {                        action: 'prix_fixation',                        type: 'no_fixing',                        dimension_id : dimensionId,                        maitere_id : matiereId                    },                    success: function(result){                        setPrixValuetoInput(result.prix_image);                    },                    error : function(result, statut, erreur){                        console.log(erreur);                    }                });                break;            case 'adhesif_fixing':                //---------------- warning plaque dimension --------------                if ($('#dimensionssel option:selected').val() == '0') {                    swal({                        title: "Attention",                        text: "Vous devez saisir au moins choisir une dimension avant de pouvoir continuer !",                        type: "warning",                        closeOnConfirm: true                    });                    return false;                }                var dimensionSelected = $('#dimensionssel option:selected').val();                //---------------- warning plaque dimension --------------                $.ajax({                    type: "POST",                    url: strUrlModuleHTML5 + "ajax/plaquespro_prix_regle.php",                    dataType: "json",                    data: {                        action: 'prix_fixation',                        type: 'adhesif_fixing',                        dimension_id : dimensionId,                        maitere_id : matiereId                    },                    success: function(result){                        setPrixValuetoInput(result.prix_image);                    },                    error : function(result, statut, erreur){                        console.log(erreur);                    }                });                break;            default:                return;        }    }    /** ---------- END - function set prix ------- **/    /** -- START - set input value ----------**/    function setPrixValuetoInput($valuPrix){        var prixHT = parseFloat($valuPrix);        var tva = (Math.round(parseFloat($valuPrix) / 100)) * tvaNormal;        var prixTTC = parseFloat(prixHT) + parseFloat(tva);        $('#prix_ht span').html(Number(prixHT).toFixed(2));        $('#prix_ttc span').html(Number(prixTTC).toFixed(2));    }    /** ----- END - set input value ---- **/    /** ------ START - set prix onchange dimension & matiere ---- **/    function setPrixDimensionMatiere($dimensionId, $matiereId){        $.ajax({            type: "POST",            dataType: "json",            url: strUrlModuleHTML5 + "ajax/plaques_tailles.php",            data: {                action : "edit_prix",                id: parseInt($dimensionId),                matiere: parseInt($matiereId),            },            success: function (result) {                var prixHT = result['prix'];                setPrixValuetoInput(prixHT);                //$('#prix_ht span').html(result['prix']);                $('#prix_constate').html(result['prix_constate']);                var eSize = result['dimensions'].split('x');                var elongueur = eSize[0],                    ehauteur = eSize[1];                if (elongueur > ehauteur) {                    var ratio = ehauteur / elongueur;                    $.data(document.body, 'ratioCfg', ratio);                    var newHeight = parseInt(750) * ratio;                    if (newHeight <= 500)                        $('#plaque_bg, #plaque_content').width(750).height(newHeight);                    else                        $('#plaque_bg, #plaque_content').width(500 / ratio).height(500);                } else if (ehauteur > elongueur) {                    var ratio = elongueur / ehauteur;                    $.data(document.body, 'ratioCfg', ratio);                    var newWidth = parseInt(500) * ratio;                    if (newWidth <= 750)                        $('#plaque_bg, #plaque_content').height(500).width(500 * ratio);                    else                        $('#plaque_bg, #plaque_content').height(750 / ratio).width(750);                } else if (ehauteur == elongueur) {                    $('#plaque_bg, #plaque_content').height(500).width(500);                }                if (result['entretoises'] == 2) {                    var distance_g = result['entretoise_gauche'].split('x');                    var distance_d = result['entretoise_droite'].split('x');                    var eg_haut = distance_g[0];                    var eg_gauche = distance_g[1];                    var ed_haut = distance_d[0];                    var ed_droite = distance_d[1];                    var fixationdiv = '<div class="fixation2 fixation_g" style="left:' + eg_gauche + ';top:' + eg_haut + '"></div><div class="fixation2 fixation_d" style="right:' + ed_droite + ';top:' + ed_haut + '"></div>';                } else {                    var fixationdiv = '<div class="fixation fixation_hg"></div><div class="fixation fixation_hd"></div><div class="fixation fixation_bg"></div><div class="fixation fixation_bd"></div>';                }                $('#fixations_plaque').html(fixationdiv);                $('.fixation, .fixation2').show();                $('#plaque_bg').center(true);                calculPrixTotal();            }        });    }    /** ------- END - set prix onchange dimension & matiere ---- **/    /** ----- generate pdf button  ----- **/    $("#pdf_button").click(function(e){        e.preventDefault();        generatePdf('pdf');    })    /** ----- generate pdf button  ----- **/    /** ---------- generate PDF -------------**/    function generatePdf($pdfLaunch){        var imgData = $(".elemContent").attr("src");        var elements=[];        $(".elementContainer img.elemContent").each(function (index) {            //console.log("test"+$(this).closest( ".elementContainer" ).position());            src = $(this).attr("alt");            var width = $(this).width();            var height = $(this).height();            style = $(this).closest('.elementContainer').attr("style");            anglecurrent = getRotationDegrees($(this).closest( ".elementContainer" ));            var correctionxplaque="";            var correctionyplaque="";            if (typeof $(this).closest('.elementContainer').attr( "correctionx" ) !== typeof undefined && $(this).closest('.elementContainer').attr( "correctionx" ) !== false) {                correctionxplaque=$(this).closest('.elementContainer').attr( "correctionx" );            }            if (typeof $(this).closest('.elementContainer').attr( "correctiony" ) !== typeof undefined &&  $(this).closest('.elementContainer').attr( "correctiony" ) !== false) {                correctionyplaque= $(this).closest('.elementContainer').attr( "correctiony" );            }            var position = $(this).closest( ".elementContainer" ).position();            if($(this).closest('.elementContainer').hasClass("typeText")){                font= $(this).closest('.elementContainer').attr("fontattr");                fontsize= $(this).closest('.elementContainer').attr("fontsize");            }else{                font= "0";                fontsize= "0";            }            datacolorcode=$(this).attr("data-colorcode");            elements[index] = {src: src, style: style,font:font,width:width,                height:height,datacolorcode:datacolorcode,fontsize:fontsize,                correctionxplaque:position.left,correctionyplaque:position.top,                anglecurrent:anglecurrent            };        });        /*         var heightplaque=$("#plaque_bg").css( "height" );         var widthplaque=$("#plaque_bg").css( "width" );         var toplaque=$("#plaque_bg").css( "top" );         var leftplaque=$("#plaque_bg").css( "left" );         */        var heightplaque=$("#plaque_content").css( "height" );        var widthplaque=$("#plaque_content").css( "width" );        var toplaque="0px";        var leftplaque="0px";        var params = JSON.stringify(elements);        var infoplaques = JSON.stringify({heightplaque:heightplaque,widthplaque:widthplaque,toplaque:toplaque,leftplaque:leftplaque });        $.ajax({            url : './html5/ajax/ajaxtcpdf.php',            type : 'post',            dataType : 'json',            data: {info:params,infoplaques:infoplaques},            success : function(result){                if(result['file_stat'] === 1){                    var urlPdf = './html5/ajax/'+result['pdf_path'];                    switch($pdfLaunch) {                        case "pdf":                            window.open(urlPdf, '_blank');                            break;                        case "cart":                            $("#add_url_pdf").val('http://'+host+ '/html5/ajax/'+result['pdf_path']);                            break;                        default:                            console.log("Undefined");                    }                }            },            error : function(data){                console.log(data);            },            async:false,            cache:false        });    }    /** ---------- generate PDF -------------**/    function getRotationDegrees(obj) {        var matrix = obj.css("-webkit-transform") ||            obj.css("-moz-transform")    ||            obj.css("-ms-transform")     ||            obj.css("-o-transform")      ||            obj.css("transform");        if(matrix !== 'none') {            var values = matrix.split('(')[1].split(')')[0].split(',');            var a = values[0];            var b = values[1];            var angle = Math.round(Math.atan2(b, a) * (180/Math.PI));        } else { var angle = 0; }        return (angle < 0) ? angle + 360 : angle;    }});